<!DOCTYPE html>
<html lang=en>
<head>
    <meta charset="utf-8">
    
    <title>Vue3入门 | Jiahao Peng</title>
    
    
        <meta name="keywords" content="web,vue3,前端" />
    
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="01 第一个 Vue3 项目 1.1 搭建开发环境 本节介绍如何使用官方推荐的方式创建一个 vue3 项目。  在控制台中输入如下代码：  1npm create vue@latest  控制台会显示要求输入项目名称，以及有关于 vue 项目的各种配置，按需设置即可：  123456789101112131415161718Vue.js - The Progressive J">
<meta property="og:type" content="article">
<meta property="og:title" content="Vue3入门">
<meta property="og:url" content="https://example.com/2024/02/17/vue3/index.html">
<meta property="og:site_name" content="Jiahao Peng">
<meta property="og:description" content="01 第一个 Vue3 项目 1.1 搭建开发环境 本节介绍如何使用官方推荐的方式创建一个 vue3 项目。  在控制台中输入如下代码：  1npm create vue@latest  控制台会显示要求输入项目名称，以及有关于 vue 项目的各种配置，按需设置即可：  123456789101112131415161718Vue.js - The Progressive J">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://example.com/img/vue3-01.png">
<meta property="og:image" content="https://example.com/img/vue3-01.gif">
<meta property="og:image" content="https://example.com/img/vue3-02.gif">
<meta property="og:image" content="https://example.com/img/vue3-02.png">
<meta property="og:image" content="https://example.com/img/vue3-03.png">
<meta property="og:image" content="https://example.com/img/vue3-03.gif">
<meta property="og:image" content="https://example.com/img/vue3-04.gif">
<meta property="og:image" content="https://example.com/img/vue3-05.gif">
<meta property="og:image" content="https://example.com/img/vue3-04.png">
<meta property="og:image" content="https://example.com/img/vue3-05.png">
<meta property="og:image" content="https://example.com/img/vue3-06.gif">
<meta property="og:image" content="https://example.com/img/vue3-07.gif">
<meta property="og:image" content="https://example.com/img/vue3-08.gif">
<meta property="og:image" content="https://example.com/img/vue3-09.gif">
<meta property="og:image" content="https://example.com/img/vue3-10.gif">
<meta property="og:image" content="https://example.com/img/vue3-11.gif">
<meta property="og:image" content="https://example.com/img/vue3-12.gif">
<meta property="og:image" content="https://example.com/img/vue3-13.gif">
<meta property="og:image" content="https://example.com/img/vue3-14.gif">
<meta property="og:image" content="https://example.com/img/vue3-15.gif">
<meta property="og:image" content="https://example.com/img/vue3-16.gif">
<meta property="og:image" content="https://example.com/img/vue3-17.gif">
<meta property="og:image" content="https://example.com/img/vue3-18.gif">
<meta property="og:image" content="https://example.com/img/vue3-19.gif">
<meta property="og:image" content="https://example.com/img/vue3-20.gif">
<meta property="og:image" content="https://example.com/img/vue3-06.png">
<meta property="og:image" content="https://example.com/img/vue3-21.gif">
<meta property="og:image" content="https://example.com/img/vue3-07.png">
<meta property="og:image" content="https://example.com/img/vue3-08.png">
<meta property="og:image" content="https://example.com/img/vue3-09.png">
<meta property="og:image" content="https://example.com/img/vue3-10.png">
<meta property="og:image" content="https://example.com/img/vue3-11.png">
<meta property="og:image" content="https://example.com/img/vue3-12.png">
<meta property="og:image" content="https://example.com/img/vue3-13.png">
<meta property="og:image" content="https://example.com/img/vue3-14.png">
<meta property="og:image" content="https://example.com/img/vue3-22.gif">
<meta property="og:image" content="https://example.com/img/vue3-23.gif">
<meta property="og:image" content="https://example.com/img/vue3-24.gif">
<meta property="og:image" content="https://example.com/img/vue3-15.png">
<meta property="og:image" content="https://example.com/img/vue3-25.gif">
<meta property="og:image" content="https://example.com/img/vue3-16.png">
<meta property="og:image" content="https://example.com/img/vue3-17.png">
<meta property="og:image" content="https://example.com/img/vue3-18.png">
<meta property="og:image" content="https://example.com/img/vue3-19.png">
<meta property="og:image" content="https://example.com/img/vue3-20.png">
<meta property="og:image" content="https://example.com/img/vue3-26.gif">
<meta property="og:image" content="https://example.com/img/vue3-21.png">
<meta property="og:image" content="https://example.com/img/vue3-27.gif">
<meta property="article:published_time" content="2024-02-17T06:54:18.000Z">
<meta property="article:modified_time" content="2025-04-12T04:55:41.520Z">
<meta property="article:author" content="me">
<meta property="article:tag" content="web">
<meta property="article:tag" content="vue3">
<meta property="article:tag" content="前端">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://example.com/img/vue3-01.png">
    

    

    
        <link rel="icon" href="/favicon.ico" />
    

    
<link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">

    
<link rel="stylesheet" href="/libs/open-sans/styles.css">

    
<link rel="stylesheet" href="/libs/source-code-pro/styles.css">


    
<link rel="stylesheet" href="/css/style.css">

    
<script src="/libs/jquery/2.1.3/jquery.min.js"></script>

    
<script src="/libs/jquery/plugins/cookie/1.4.1/jquery.cookie.js"></script>

    
    
        
<link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">

    
    
        
<link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">

    
    
    
    


    
<meta name="generator" content="Hexo 7.3.0"></head>

<body>
    <div id="container">
        <header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="/" id="logo">
                
                <span class="site-title">Jiahao Peng</span>
            </a>
            <nav id="main-nav">
                
                    <a class="main-nav-link" href="/">首页</a>
                
                    <a class="main-nav-link" href="/archives">归档</a>
                
                    <a class="main-nav-link" href="/categories">分类</a>
                
                    <a class="main-nav-link" href="/tags">标签</a>
                
            </nav>
            
                
                <nav id="sub-nav">
                    <div class="profile" id="profile-nav">
                        <a id="profile-anchor" href="javascript:;">
                            <img class="avatar" src="/images/logo.jpg" />
                            <i class="fa fa-caret-down"></i>
                        </a>
                    </div>
                </nav>
            
            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>


</div>
        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tr>
                
                    <td><a class="main-nav-link" href="/">首页</a></td>
                
                    <td><a class="main-nav-link" href="/archives">归档</a></td>
                
                    <td><a class="main-nav-link" href="/categories">分类</a></td>
                
                    <td><a class="main-nav-link" href="/tags">标签</a></td>
                
                <td>
                    
    <div class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search" />
    </div>

                </td>
            </tr>
        </table>
    </div>
</header>

        <div class="outer">
            
                

<aside id="profile">
    <div class="inner profile-inner">
        <div class="base-info profile-block">
            <img id="avatar" src="/images/logo.jpg" />
            <h2 id="name">Jiahao Peng</h2>
            <h3 id="title">Postgraduate &amp; Software Engineering</h3>
            <span id="location"><i class="fa fa-map-marker"></i>Zhejiang, China</span>
            <a id="follow" target="_blank" href="https://github.com/Chordrain/Chordrain.github.io">FOLLOW</a>
        </div>
        <div class="article-info profile-block">
            <div class="article-info-block">
                12
                <span>posts</span>
            </div>
            <div class="article-info-block">
                20
                <span>tags</span>
            </div>
        </div>
        
    </div>
</aside>

            
            
                <aside id="sidebar">
   
        
    <div class="widget-wrap" id='categories'>
        <h3 class="widget-title">
            <span>categories</span>
            &nbsp;
            <a id='allExpand' href="#">
                <i class="fa fa-angle-double-down fa-2x"></i>
            </a>
        </h3>
        
        
        
         <ul class="unstyled" id="tree" > 
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            Debugging
                        </a>
                         <ul class="unstyled" id="tree" >  <li class="file"><a href="/2025/04/05/A-WSL-Error-Encountered-When-installing-Docker/">A WSL Error Encountered When Installing Docker</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            【Lecture】Software Analysis Testing and Verification
                        </a>
                         <ul class="unstyled" id="tree" >  <li class="file"><a href="/2025/04/04/Introduction-to-Program-Analysis/">Introduction to Program Analysis</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory open">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder-open"></i>
                            &nbsp;
                            前端开发
                        </a>
                         <ul class="unstyled" id="tree" >  <li class="file active"><a href="/2024/02/17/vue3/">Vue3入门</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            深度学习
                        </a>
                         <ul class="unstyled" id="tree" >  <li class="file"><a href="/2023/09/09/%E8%87%AA%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6-Self-attention/">自注意力机制 Self-attention</a></li>  <li class="file"><a href="/2023/10/24/Transformer/">Transformer</a></li>  <li class="file"><a href="/2024/04/03/%E5%9B%BE%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6/">图注意力机制的原理</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            自我总结
                        </a>
                         <ul class="unstyled" id="tree" >  <li class="file"><a href="/2025/03/23/ECNU%E8%BD%AF%E5%AD%A6%E5%A4%8D%E8%AF%95%E6%80%BB%E7%BB%93/">ECNU软学复试总结</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            计算机专业基础
                        </a>
                         <ul class="unstyled" id="tree" >  <li class="file"><a href="/2022/07/21/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%85%A5%E9%97%A8-%E5%90%B4%E6%81%A9%E8%BE%BE/">机器学习入门 吴恩达</a></li>  <li class="file"><a href="/2023/12/10/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E5%AD%A6/">计算机图形学</a></li>  <li class="file"><a href="/2023/12/11/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD%E6%8A%80%E6%9C%AF/">人工智能技术杂谈</a></li>  <li class="file"><a href="/2025/03/18/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6/">离散数学</a></li>  </ul> 
                    </li> 
                     <li class="file"><a href="/2021/04/05/Welcome/">✨Welcome!✨</a></li>  </ul> 
    </div>
    <script>
        $(document).ready(function() {
            var iconFolderOpenClass  = 'fa-folder-open';
            var iconFolderCloseClass = 'fa-folder';
            var iconAllExpandClass = 'fa-angle-double-down';
            var iconAllPackClass = 'fa-angle-double-up';
            // Handle directory-tree expansion:
            // 左键单独展开目录
            $(document).on('click', '#categories a[data-role="directory"]', function (event) {
                event.preventDefault();

                var icon = $(this).children('.fa');
                var expanded = icon.hasClass(iconFolderOpenClass);
                var subtree = $(this).siblings('ul');
                icon.removeClass(iconFolderOpenClass).removeClass(iconFolderCloseClass);
                if (expanded) {
                    if (typeof subtree != 'undefined') {
                        subtree.slideUp({ duration: 100 });
                    }
                    icon.addClass(iconFolderCloseClass);
                } else {
                    if (typeof subtree != 'undefined') {
                        subtree.slideDown({ duration: 100 });
                    }
                    icon.addClass(iconFolderOpenClass);
                }
            });
            // 右键展开下属所有目录
            $('#categories a[data-role="directory"]').bind("contextmenu", function(event){
                event.preventDefault();
                
                var icon = $(this).children('.fa');
                var expanded = icon.hasClass(iconFolderOpenClass);
                var listNode = $(this).siblings('ul');
                var subtrees = $.merge(listNode.find('li ul'), listNode);
                var icons = $.merge(listNode.find('.fa'), icon);
                icons.removeClass(iconFolderOpenClass).removeClass(iconFolderCloseClass);
                if(expanded) {
                    subtrees.slideUp({ duration: 100 });
                    icons.addClass(iconFolderCloseClass);
                } else {
                    subtrees.slideDown({ duration: 100 });
                    icons.addClass(iconFolderOpenClass);
                }
            })
            // 展开关闭所有目录按钮
            $(document).on('click', '#allExpand', function (event) {
                event.preventDefault();
                
                var icon = $(this).children('.fa');
                var expanded = icon.hasClass(iconAllExpandClass);
                icon.removeClass(iconAllExpandClass).removeClass(iconAllPackClass);
                if(expanded) {
                    $('#sidebar .fa.fa-folder').removeClass('fa-folder').addClass('fa-folder-open')
                    $('#categories li ul').slideDown({ duration: 100 });
                    icon.addClass(iconAllPackClass);
                } else {
                    $('#sidebar .fa.fa-folder-open').removeClass('fa-folder-open').addClass('fa-folder')
                    $('#categories li ul').slideUp({ duration: 100 });
                    icon.addClass(iconAllExpandClass);
                }
            });  
        });
    </script>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title"><span>recent</span></h3>
        <div class="widget">
            <ul id="recent-post" class="no-thumbnail">
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Debugging/">Debugging</a></p>
                            <p class="item-title"><a href="/2025/04/05/A-WSL-Error-Encountered-When-installing-Docker/" class="title">A WSL Error Encountered When Installing Docker</a></p>
                            <p class="item-date"><time datetime="2025-04-05T14:30:36.000Z" itemprop="datePublished">2025-04-05</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/%E3%80%90Lecture%E3%80%91Software-Analysis-Testing-and-Verification/">【Lecture】Software Analysis Testing and Verification</a></p>
                            <p class="item-title"><a href="/2025/04/04/Introduction-to-Program-Analysis/" class="title">Introduction to Program Analysis</a></p>
                            <p class="item-date"><time datetime="2025-04-04T13:58:30.000Z" itemprop="datePublished">2025-04-04</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/%E8%87%AA%E6%88%91%E6%80%BB%E7%BB%93/">自我总结</a></p>
                            <p class="item-title"><a href="/2025/03/23/ECNU%E8%BD%AF%E5%AD%A6%E5%A4%8D%E8%AF%95%E6%80%BB%E7%BB%93/" class="title">ECNU软学复试总结</a></p>
                            <p class="item-date"><time datetime="2025-03-23T03:46:26.000Z" itemprop="datePublished">2025-03-23</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E4%B8%93%E4%B8%9A%E5%9F%BA%E7%A1%80/">计算机专业基础</a></p>
                            <p class="item-title"><a href="/2025/03/18/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6/" class="title">离散数学</a></p>
                            <p class="item-date"><time datetime="2025-03-18T06:16:34.000Z" itemprop="datePublished">2025-03-18</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/">深度学习</a></p>
                            <p class="item-title"><a href="/2024/04/03/%E5%9B%BE%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6/" class="title">图注意力机制的原理</a></p>
                            <p class="item-date"><time datetime="2024-04-03T03:23:32.000Z" itemprop="datePublished">2024-04-03</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title"><span>tag cloud</span></h3>
        <div class="widget tagcloud">
            <a href="/tags/a-star/" style="font-size: 10px;">a-star</a> <a href="/tags/ai/" style="font-size: 10px;">ai</a> <a href="/tags/attention/" style="font-size: 20px;">attention</a> <a href="/tags/deduction/" style="font-size: 10px;">deduction</a> <a href="/tags/discrete-math/" style="font-size: 10px;">discrete math</a> <a href="/tags/docker/" style="font-size: 10px;">docker</a> <a href="/tags/error/" style="font-size: 10px;">error</a> <a href="/tags/gnn/" style="font-size: 10px;">gnn</a> <a href="/tags/graphics/" style="font-size: 10px;">graphics</a> <a href="/tags/heuristic-search/" style="font-size: 10px;">heuristic search</a> <a href="/tags/hmm/" style="font-size: 10px;">hmm</a> <a href="/tags/machine-learning/" style="font-size: 20px;">machine learning</a> <a href="/tags/program-analysis/" style="font-size: 10px;">program analysis</a> <a href="/tags/svm/" style="font-size: 10px;">svm</a> <a href="/tags/transformer/" style="font-size: 10px;">transformer</a> <a href="/tags/vscode/" style="font-size: 10px;">vscode</a> <a href="/tags/vue3/" style="font-size: 10px;">vue3</a> <a href="/tags/web/" style="font-size: 10px;">web</a> <a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 10px;">前端</a> <a href="/tags/%E7%94%9F%E6%B4%BB/" style="font-size: 10px;">生活</a>
        </div>
    </div>

    
    <div id="toTop" class="fa fa-angle-up"></div>
</aside>
            
            <section id="main"><article id="post-vue3" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
                    <div class="article-meta">
                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/">前端开发</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link-link" href="/tags/vue3/" rel="tag">vue3</a>, <a class="tag-link-link" href="/tags/web/" rel="tag">web</a>, <a class="tag-link-link" href="/tags/%E5%89%8D%E7%AB%AF/" rel="tag">前端</a>
    </div>

                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2024/02/17/vue3/">
            <time datetime="2024-02-17T06:54:18.000Z" itemprop="datePublished">2024-02-17</time>
        </a>
    </div>


                        
                        
                        
                    </div>
                
                
    
        <h1 class="article-title" itemprop="name">
            Vue3入门
        </h1>
    

            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
        
            
                <div id="toc" class="toc-article">
                <strong class="toc-title">Catalogue</strong>
                    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E4%B8%AA-vue3-%E9%A1%B9%E7%9B%AE"><span class="toc-number">1.</span> <span class="toc-text">01 第一个 Vue3 项目</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%90%AD%E5%BB%BA%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 搭建开发环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#app-%E7%BB%84%E4%BB%B6"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 App 组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#options-api-%E5%92%8C-composition-api"><span class="toc-number">1.3.</span> <span class="toc-text">1.3 Options API 和 Composition
API</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#setup"><span class="toc-number">2.</span> <span class="toc-text">02 setup</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9D%E8%AF%86-setup"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 初识 setup</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#setup-%E5%92%8C-options-api"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 setup 和 Options API</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#setup-%E8%AF%AD%E6%B3%95%E7%B3%96"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 setup 语法糖</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%93%8D%E5%BA%94%E5%BC%8F%E6%95%B0%E6%8D%AE"><span class="toc-number">3.</span> <span class="toc-text">03 响应式数据</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%93%8D%E5%BA%94%E5%BC%8F"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 基本类型的响应式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%93%8D%E5%BA%94%E5%BC%8F"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 对象类型的响应式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ref-%E5%92%8C-reactive"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 ref 和 reactive</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ref-vs-reactive"><span class="toc-number">3.4.</span> <span class="toc-text">3.4 ref vs reactive</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#torefs-toref"><span class="toc-number">3.5.</span> <span class="toc-text">3.5 toRefs &amp; toRef</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#computed-%E8%AE%A1%E7%AE%97%E5%B1%9E%E6%80%A7"><span class="toc-number">4.</span> <span class="toc-text">04 computed 计算属性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E5%B1%9E%E6%80%A7%E7%9A%84%E7%94%A8%E6%B3%95"><span class="toc-number">4.1.</span> <span class="toc-text">4.1 计算属性的用法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#setter-%E5%92%8C-getter"><span class="toc-number">4.2.</span> <span class="toc-text">4.2 setter 和 getter</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#watch-%E7%9B%91%E8%A7%86"><span class="toc-number">5.</span> <span class="toc-text">05 watch 监视</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%83%85%E5%86%B5%E4%B8%80ref-%E5%AE%9A%E4%B9%89%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B%E6%95%B0%E6%8D%AE"><span class="toc-number">5.1.</span> <span class="toc-text">5.1 情况一：ref
定义的基本类型数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%83%85%E5%86%B5%E4%BA%8Cref-%E5%AE%9A%E4%B9%89%E7%9A%84%E5%AF%B9%E8%B1%A1%E7%B1%BB%E5%9E%8B%E6%95%B0%E6%8D%AE"><span class="toc-number">5.2.</span> <span class="toc-text">5.2 情况二：ref
定义的对象类型数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%83%85%E5%86%B5%E4%B8%89reactive-%E5%AE%9A%E4%B9%89%E7%9A%84%E5%AF%B9%E8%B1%A1%E7%B1%BB%E5%9E%8B%E6%95%B0%E6%8D%AE"><span class="toc-number">5.3.</span> <span class="toc-text">5.3 情况三：reactive
定义的对象类型数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%83%85%E5%86%B5%E5%9B%9B%E7%9B%91%E8%A7%86%E5%AF%B9%E8%B1%A1%E4%B8%8A%E7%9A%84%E6%9F%90%E4%B8%AA%E5%80%BC"><span class="toc-number">5.4.</span> <span class="toc-text">5.4 情况四：监视对象上的某个值</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B%E5%B1%9E%E6%80%A7"><span class="toc-number">5.4.1.</span> <span class="toc-text">5.4.1 基本类型属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1%E7%B1%BB%E5%9E%8B%E5%B1%9E%E6%80%A7"><span class="toc-number">5.4.2.</span> <span class="toc-text">5.4.2 对象类型属性</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%83%85%E5%86%B5%E4%BA%94%E7%9B%91%E8%A7%86%E5%AF%B9%E8%B1%A1%E4%B8%8A%E7%9A%84%E6%9F%90%E4%BA%9B%E5%80%BC"><span class="toc-number">5.5.</span> <span class="toc-text">5.5 情况五：监视对象上的某些值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#watcheffect"><span class="toc-number">5.6.</span> <span class="toc-text">5.6 watchEffect</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%87%E7%AD%BE%E7%9A%84-ref-%E5%B1%9E%E6%80%A7"><span class="toc-number">6.</span> <span class="toc-text">06 标签的 ref 属性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ref-%E5%B1%9E%E6%80%A7"><span class="toc-number">6.1.</span> <span class="toc-text">6.1 ref 属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#defineexpose"><span class="toc-number">6.2.</span> <span class="toc-text">6.2 defineExpose</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#props"><span class="toc-number">7.</span> <span class="toc-text">07 props</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#props-%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">7.1.</span> <span class="toc-text">7.1 props 的使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B%E9%99%90%E5%88%B6"><span class="toc-number">7.2.</span> <span class="toc-text">7.2 类型限制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BF%85%E8%A6%81%E6%80%A7%E9%99%90%E5%88%B6"><span class="toc-number">7.3.</span> <span class="toc-text">7.3 必要性限制</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-number">8.</span> <span class="toc-text">08 生命周期</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#vue3-%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-number">8.1.</span> <span class="toc-text">8.1 Vue3 的生命周期</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E9%92%A9%E5%AD%90%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">8.2.</span> <span class="toc-text">8.2 生命周期钩子的使用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89-hooks"><span class="toc-number">9.</span> <span class="toc-text">09 自定义 hooks</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1"><span class="toc-number">10.</span> <span class="toc-text">10 路由</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">10.1.</span> <span class="toc-text">10.1 路由的基本使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E6%A0%87%E5%87%86"><span class="toc-number">10.2.</span> <span class="toc-text">10.2 开发标准</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E5%99%A8%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%A8%A1%E5%BC%8F"><span class="toc-number">10.3.</span> <span class="toc-text">10.3 路由器的工作模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#to-%E7%9A%84%E7%AC%AC%E4%BA%8C%E7%A7%8D%E5%86%99%E6%B3%95"><span class="toc-number">10.4.</span> <span class="toc-text">10.4 to 的第二种写法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E5%91%BD%E5%90%8D"><span class="toc-number">10.5.</span> <span class="toc-text">10.5 路由命名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B5%8C%E5%A5%97%E8%B7%AF%E7%94%B1"><span class="toc-number">10.6.</span> <span class="toc-text">10.6 嵌套路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E4%BC%A0%E5%8F%82"><span class="toc-number">10.7.</span> <span class="toc-text">10.7 路由传参</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#query-%E5%8F%82%E6%95%B0"><span class="toc-number">10.7.1.</span> <span class="toc-text">10.7.1 query 参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#params-%E5%8F%82%E6%95%B0"><span class="toc-number">10.7.2.</span> <span class="toc-text">10.7.2 params 参数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E7%9A%84-props-%E9%85%8D%E7%BD%AE"><span class="toc-number">10.8.</span> <span class="toc-text">10.8 路由的 props 配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#replace-%E5%B1%9E%E6%80%A7"><span class="toc-number">10.9.</span> <span class="toc-text">10.9 replace 属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E7%A8%8B%E5%BC%8F%E8%B7%AF%E7%94%B1%E5%AF%BC%E8%88%AA"><span class="toc-number">10.10.</span> <span class="toc-text">10.10 编程式路由导航</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E5%AE%9A%E5%90%91"><span class="toc-number">10.11.</span> <span class="toc-text">10.11 重定向</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pinia"><span class="toc-number">11.</span> <span class="toc-text">11 Pinia</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-pinia"><span class="toc-number">11.1.</span> <span class="toc-text">11.1 安装 Pinia</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E5%92%8C%E8%AF%BB%E5%8F%96%E6%95%B0%E6%8D%AE"><span class="toc-number">11.2.</span> <span class="toc-text">11.2 存储和读取数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E7%A7%8D%E4%BF%AE%E6%94%B9%E6%95%B0%E6%8D%AE%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="toc-number">11.3.</span> <span class="toc-text">11.3 三种修改数据的方式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%B4%E6%8E%A5%E4%BF%AE%E6%94%B9"><span class="toc-number">11.3.1.</span> <span class="toc-text">11.3.1 直接修改</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#patch"><span class="toc-number">11.3.2.</span> <span class="toc-text">11.3.2 $patch</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#actions"><span class="toc-number">11.3.3.</span> <span class="toc-text">11.3.3 actions</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#storetorefs"><span class="toc-number">11.4.</span> <span class="toc-text">11.4 storeToRefs</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#getters"><span class="toc-number">11.5.</span> <span class="toc-text">11.5 getters</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#subscribe"><span class="toc-number">11.6.</span> <span class="toc-text">11.6 $subscribe</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#store-%E7%BB%84%E5%90%88%E5%BC%8F%E5%86%99%E6%B3%95"><span class="toc-number">11.7.</span> <span class="toc-text">11.7 store 组合式写法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E9%80%9A%E4%BF%A1"><span class="toc-number">12.</span> <span class="toc-text">12 组件通信</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#props-1"><span class="toc-number">12.1.</span> <span class="toc-text">12.1 props</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E4%BA%8B%E4%BB%B6"><span class="toc-number">12.2.</span> <span class="toc-text">12.2 自定义事件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#event"><span class="toc-number">12.2.1.</span> <span class="toc-text">12.2.1 $event</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#emit"><span class="toc-number">12.2.2.</span> <span class="toc-text">12.2.2 emit</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mitt"><span class="toc-number">12.3.</span> <span class="toc-text">12.3 mitt</span></a></li></ol></li></ol>
                </div>
            
        
        
            <h2 id="第一个-vue3-项目">01 第一个 Vue3 项目</h2>
<h3 id="搭建开发环境">1.1 搭建开发环境</h3>
<p>本节介绍如何使用官方推荐的方式创建一个 vue3 项目。</p>
<ol type="1">
<li>在控制台中输入如下代码：</li>
</ol>
<figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm create vue@latest</span><br></pre></td></tr></table></figure>
<ol start="2" type="1">
<li>控制台会显示要求输入项目名称，以及有关于 vue
项目的各种配置，按需设置即可：</li>
</ol>
<figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Vue.js - The Progressive JavaScript Framework</span><br><span class="line"></span><br><span class="line">√ 请输入项目名称： ... hello_vue3</span><br><span class="line">√ 是否使用 TypeScript 语法？ ... 否 / 是</span><br><span class="line">√ 是否启用 JSX 支持？ ... 否 / 是</span><br><span class="line">√ 是否引入 Vue Router 进行单页面应用开发？ ... 否 / 是</span><br><span class="line">√ 是否引入 Pinia 用于状态管理？ ... 否 / 是</span><br><span class="line">√ 是否引入 Vitest 用于单元测试？ ... 否 / 是</span><br><span class="line">√ 是否要引入一款端到端（End to End）测试工具？ » 不需要</span><br><span class="line">√ 是否引入 ESLint 用于代码质量检测？ ... 否 / 是</span><br><span class="line"></span><br><span class="line">正在构建项目 C:\Users\<span class="number">24159</span>\Desktop\hello_vue3...</span><br><span class="line"></span><br><span class="line">项目构建完成，可执行以下命令：</span><br><span class="line"></span><br><span class="line">  <span class="built_in">cd</span> hello_vue3</span><br><span class="line">  npm install</span><br><span class="line">  npm run dev</span><br></pre></td></tr></table></figure>
<ol start="3" type="1">
<li>随后，在控制台所在的路径上会出现一个新的文件夹，名称和你输入的项目名称一致，这便是你的项目文件，进入该文件
(<code>cd 文件名</code>)，输入 <code>npm install</code>
安装项目的所有依赖，最后输入 <code>npm run dev</code>
便可以开发模式启动项目。</li>
</ol>
<hr />
<p>编辑 vue 代码的 IDE 建议选择 VSCode，官方专门为 VSCode 开发了两个编写
vue 的插件，分别叫 Vue Language Features (Volar) 和 TypeScript Vue
Plugin (Volar)，在插件市场搜索 Volar，排名最靠前的两个就是。</p>
<h3 id="app-组件">1.2 App 组件</h3>
<p>打开项目文件夹，其中有一个叫做 src
的文件夹，这个文件夹是我们的“主战场”，意思是代码基本上都写在这里面。这个文件中最重要的一个文件是
main.ts，这是项目的入口文件，其内容很简单：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./assets/main.css&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">createApp</span>(<span class="title class_">App</span>).<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>第一句话引入 css 样式。第二句话是从 vue 中引入创建应用的方法
createApp。第三句话从 App.vue 中引入 App 根组件。第四句话则是使用
createApp 方法，将 App 组件创建出来，mount
的意思是挂载，即创建完后要将组件装入哪里，参数 <code>#app</code>
是指挂在到 index.html 中 id 为 app 的容器。</p>
<p>所以，index.html 中可以什么都没有，但是不能没有 id 为 app
的标签，而且必须引入 main.ts。</p>
<hr />
<p>上面我们提到了 App 组件，这是一个<strong>根组件</strong>，编写在
App.vue 中。在 src 下还有一个文件夹叫做
components，这个文件夹就是组件文件夹，用来存放其他组件。</p>
<p>组件的一个标志就是，其文件后缀名是 .vue。在一个 .vue
文件中，我们可以些三种标签：<code>&lt;template&gt;</code>、<code>&lt;script&gt;</code>、<code>&lt;style&gt;</code>。<code>&lt;template&gt;</code>
中写 html 结构，<code>&lt;script&gt;</code> 中写 js 或 ts
代码，<code>&lt;style&gt;</code> 中写 css 代码。直接写
<code>&lt;script&gt;</code> 可能会飘黄，这是因为 vue3 推荐我们使用 ts
语法，解决方法是添加 lang
属性：<code>&lt;script lang='ts'&gt;</code>。虽然 lang
声明了使用的语言，但是由于 ts 是 js 的超集，所以 js 也同样可以使用。</p>
<h3 id="options-api-和-composition-api">1.3 Options API 和 Composition
API</h3>
<p>在 vue2 中，我们可以在 <code>&lt;script&gt;</code>
标签中通过如下方式创建 API：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;App&#x27;</span>,</span><br><span class="line">    <span class="title function_">data</span>(<span class="params"></span>) &#123;&#125;,</span><br><span class="line">    <span class="attr">computed</span>: &#123;&#125;,</span><br><span class="line">    <span class="attr">methods</span>: &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这种 API 称为选项式 API (Options API)，其中所有的配置项，例如
name、data、computed、methods 等，这些都是一种选项。这种 API
的弊端在于过于分散，实现一个功能可能需要去修改各个配置项。</p>
<p>Vue3 对 Options API 进行了改进，提出了组合式 API (Composition
API)，以功能为单位，将实现某一个功能的各种数据、方法、监视等放到一起，封装成一个个函数，比
Options API 更加集中。</p>
<h2 id="setup">02 setup</h2>
<h3 id="初识-setup">2.1 初识 setup</h3>
<p>Setup 是 vue3 提供的新配置项，其写法跟 Options API 是一样的：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;script lang=<span class="string">&#x27;ts&#x27;</span>&gt;</span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;App&#x27;</span>,</span><br><span class="line">        <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">            ...</span><br><span class="line">            <span class="keyword">return</span> ...</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>可以看到，setup 在写法上类似于 vue2 中的 computed、methods，但在 vue3
当中，仅凭 setup 就能完成 data、computed、methods
等配置项的任务。如果我们需要定义新的数据或者方法，直接用 js 的语法在
setup 中定义就行了，例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;script lang=<span class="string">&#x27;ts&#x27;</span>&gt;</span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;App&#x27;</span>,</span><br><span class="line">        <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">let</span> name = <span class="string">&#x27;xiaoming&#x27;</span>;</span><br><span class="line">            <span class="keyword">function</span> <span class="title function_">changeName</span>(<span class="params"></span>) &#123;</span><br><span class="line">                name = <span class="string">&#x27;xiaozhi&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="attr">name</span>: name, <span class="attr">changeName</span>: changeName&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>如上，我们就成功创建了数据 name 和方法
changeName，组件已经可以使用它们了。</p>
<blockquote>
<ul>
<li><p>return 的内容是一组键值对
(对象)，组件中若想使用数据或方法，需要使用键；而当键和值相同时，可以直接写值。例如上面的例子里就可以直接写成
<code>return &#123;name, changeName&#125;;</code>。</p></li>
<li><p>另外要注意的一点是，如上所写的内容还不是响应式的，意思是如果
changeName 方法被调用，name
被修改，页面上的内容也不会发生变化。如何解决这一点我们暂且不讲，因为这与
setup 的知识无关。</p></li>
</ul>
</blockquote>
<h3 id="setup-和-options-api">2.2 setup 和 Options API</h3>
<p>Vue3 是兼容 vue2 的，所以 Options API 的写法在 vue3
中仍能使用。这里就诞生了一个问题：我们在 data 或者 computed 这些 Options
API 中写的数据，能否访问到 setup 中的内容？</p>
<p>这里稍微复习一下 vue2 的知识，在 vue2，<code>this</code>
是一个极为重要的东西，它指向 app
组件本身，通过它可以读取到我们配置的所有属性和方法。那么现在，假设我们这样写代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;script lang=&#x27;ts&#x27;&gt;</span><br><span class="line">    export default &#123;</span><br><span class="line">        name: &#x27;App&#x27;,</span><br><span class="line">        data() &#123;</span><br><span class="line">            return &#123;a: this.name&#125;;  // 重点在这！！</span><br><span class="line">        &#125;,</span><br><span class="line">        setup() &#123;</span><br><span class="line">            let name = &#x27;xiaoming&#x27;;</span><br><span class="line">            return &#123;name&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>请问，data 中设置的数据 a 能否正常访问到 setup 中的 name
呢？答案是可以。这里要引出一个很重要的知识点：==setup 的调用时机在
beforeCreate 之前==。如果你学过 vue2 你就会知道，beforeCreate
这个生命周期钩子是最早执行的生命周期钩子，在这一步，组件尚未被创建，<code>this</code>
还未存在，而 setup 的调用时机比 beforeCreate 还早，说明在 setup
中，我们是无法使用 <code>this</code> 的！可以说，vue3 已经在弱化
<code>this</code> 的作用了。Setup 中定义的数据和方法会在
<code>this</code> 被创建之后加入到 <code>this</code> 中，而 data
的调用时机则要晚得多，所以它是可以访问到 <code>this</code> 以及
<code>this</code> 上的数据 name 的。因此，上述代码是正确的。</p>
<p>通过上面的例子，我们主要要明确两点：</p>
<ol type="1">
<li>Vue2 中 Options API 的写法是可以和 vue3 中 setup 的写法共存的。</li>
<li>Options API 可以访问到 setup 中的数据和方法，但是反过来不行。</li>
</ol>
<h3 id="setup-语法糖">2.3 setup 语法糖</h3>
<p>所谓语法糖，就是能让代码更加简洁的写法。上面讲到的 setup
的写法过于繁琐，假设设置的数据和方法很多，那么 return
的内容也会很长，这是我们绝对不希望看到的。一种更加简洁的写法是：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&#x27;ts&#x27;</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> name = <span class="string">&#x27;xiaoming&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">changeName</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        name = <span class="string">&#x27;xiaozhi&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>只要在 <code>&lt;script&gt;</code> 标签中加入 setup
这个属性，我们就可以直接在其中写我们想在 setup
中写的内容了。并且我们所定义的数据和方法会自动返回，不需要手动写
return，这样可以极大方便我们编码。</p>
<hr />
<p>但是这种写法还有一个小瑕疵，因为在原本的写法中，我们还要设置 name
这个配置项，所以我们还要保留这样一段代码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&#x27;ts&#x27;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">name</span>: <span class="string">&#x27;App&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这个 name
配置的是这个组件的名称，这个名称决定了父组件如何“称呼”它。这段代码是可以省略的，如果省略，那么组件的名字就默认是
vue
文件的名字。但是假设我们一定要这个组件的名字和文件名不同，那么上面这段代码就不能省略了。这样显然会显得很冗余，不过这里有一个插件可以解决这个问题，该插件可以通过下面这段代码进行安装：</p>
<figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i vite-plugin-vue-setup-extend -D</span><br></pre></td></tr></table></figure>
<p>光下载还不够，还需要找到项目目录下的 vite.config.ts
这个文件，对其做以下修改：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; fileURLToPath, <span class="variable constant_">URL</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;node:url&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> vue <span class="keyword">from</span> <span class="string">&#x27;@vitejs/plugin-vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">VueSetupExtend</span> <span class="keyword">from</span> <span class="string">&#x27;vue-plugin-vue-setup-extend&#x27;</span>  <span class="comment">// 添加这句！！</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="title function_">vue</span>(),</span><br><span class="line">    <span class="title class_">VueSetupExtend</span>()  <span class="comment">// 这里也要改！！</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">resolve</span>: &#123;</span><br><span class="line">    <span class="attr">alias</span>: &#123;</span><br><span class="line">      <span class="string">&#x27;@&#x27;</span>: <span class="title function_">fileURLToPath</span>(<span class="keyword">new</span> <span class="title function_">URL</span>(<span class="string">&#x27;./src&#x27;</span>, <span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">url</span>))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>然后，我们就只需要在 <code>&lt;script&gt;</code> 标签中配置一个 name
属性，就可以做到设置组件的名称了：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&#x27;ts&#x27;</span> <span class="attr">setup</span> <span class="attr">name</span>=<span class="string">&#x27;App&#x27;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> name = <span class="string">&#x27;xiaoming&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">changeName</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        name = <span class="string">&#x27;xiaozhi&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>有关于插件的知识仅作了解，因为大多数应用场景下组件的名称和组件文件的名称都是相同的。</p>
<h2 id="响应式数据">03 响应式数据</h2>
<p>这一节，我们来解决之前遗留的问题 —— 如何让在 setup
中设置的数据变成响应式的。</p>
<h3 id="基本类型的响应式">3.1 基本类型的响应式</h3>
<p>在 vue3 当中，我们需要用到 <code>ref</code>
方法来实现基本类型数据的响应式。该方法的使用方法如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;script lang=&#x27;ts&#x27; setup&gt;</span><br><span class="line">    import &#123;ref&#125; from &#x27;vue&#x27;;  // 要使用ref，必须先引入</span><br><span class="line">    let age = ref(19);  // 这样就能实现age的响应式了</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>如此一来，age
就不再是一个单纯的整型变量，而是一个对象，如果在控制台中打印会显示：</p>
<p><img src="/img/vue3-01.png" /></p>
<p>由上图可见，age 被封装成了一个 RefImpl 对象，其中有一个属性
<code>value</code>，这个属性就是 age 的值。==当我们需要在 js/ts 中访问
age 的值时，我们就需要使用 <code>age.value</code>，否则是无法拿到 age
的值的；但是在 html 中不需要加
<code>.value</code>，系统会自动加上==。现在，我们尝试定义在组件中使用并修改此数据：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">	import &#123;ref&#125; from &#x27;vue&#x27;;</span><br><span class="line">	let age = ref(18);</span><br><span class="line">	function ageInc() &#123;</span><br><span class="line">		console.log(age);</span><br><span class="line">		age.value += 1;</span><br><span class="line">	&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div&gt;</span><br><span class="line">		&lt;p&gt;年龄：&#123;&#123; age &#125;&#125;&lt;/p&gt;  </span><br><span class="line">		&lt;button @click=&quot;ageInc&quot;&gt;增加年龄&lt;/button&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p>运行上面的代码，应该能得到如下的效果：</p>
<p><img src="/img/vue3-01.gif" /></p>
<p>可见，经过 <code>ref</code>
方法包装过之后，数据就变成了响应式数据，数据被改变，页面也会随之改变。</p>
<h3 id="对象类型的响应式">3.2 对象类型的响应式</h3>
<p>上面介绍的是基本类型数据的响应式，如果是对象类型的数据，则可以选择使用
<code>reactive</code> 方法：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> &#123; reactive &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> stud = <span class="title function_">reactive</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;王小明&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="string">&quot;age&quot;</span>: <span class="number">19</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="string">&quot;sex&quot;</span>: <span class="string">&quot;男&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="string">&quot;address&quot;</span>: <span class="string">&quot;浙江省杭州市xx区xx街xx号&quot;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">changeName</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        stud.<span class="property">name</span> = <span class="string">&quot;荧姐&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">changeAddress</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        stud.<span class="property">address</span> = <span class="string">&quot;提瓦特大陆&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">changeSex</span>(<span class="params"></span>) &#123;    </span></span><br><span class="line"><span class="language-javascript">        stud.<span class="property">sex</span> = <span class="string">&quot;女&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">ageInc</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        stud.<span class="property">age</span>++;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>学生信息：<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;a, b in stud&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;b&quot;</span>&gt;</span>&#123;&#123; b &#125;&#125;: &#123;&#123; a &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;a in stud&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;a&quot;</span>&gt;</span>&#123;&#123; a &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;changeName&quot;</span>&gt;</span>改姓名<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;changeSex&quot;</span>&gt;</span>改性别<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;changeAddress&quot;</span>&gt;</span>改地址<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;ageInc&quot;</span>&gt;</span>加年龄<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>效果：</p>
<p><img src="/img/vue3-02.gif" /></p>
<p>在 js 中，数组也是一种对象，所以数组也可以使用
<code>reactive</code>。此外，对于深层的对象，<code>reactive</code>
也适用。<code>reactive</code> 的原理是 Proxy，这是 js
原生的一个方法。在控制台打印被 <code>reactive</code>
定义的数据，就会得到如下结果：</p>
<p><img src="/img/vue3-02.png" /></p>
<h3 id="ref-和-reactive">3.3 ref 和 reactive</h3>
<p>虽然上面介绍的是 <code>reactive</code>
实现对象类型数据的响应式，但其实，<code>ref</code>
也可以实现。那么有什么区别呢？之前提到过，<code>ref</code>
定义的数据需要先访问 <code>value</code> 属性才能获取到数据，那么如果用
<code>ref</code> 定义对象类型数据也是同理。如果使用 <code>ref</code>
来代替 <code>reactive</code>，那么上面的 js 代码需要这么变：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> stud = <span class="title function_">ref</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;王小明&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="string">&quot;age&quot;</span>: <span class="number">19</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="string">&quot;sex&quot;</span>: <span class="string">&quot;男&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="string">&quot;address&quot;</span>: <span class="string">&quot;浙江省杭州市xx区xx街xx号&quot;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(stud);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">changeName</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        stud.<span class="property">value</span>.<span class="property">name</span> = <span class="string">&quot;荧姐&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">changeAddress</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        stud.<span class="property">value</span>.<span class="property">address</span> = <span class="string">&quot;提瓦特大陆&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">changeSex</span>(<span class="params"></span>) &#123;    </span></span><br><span class="line"><span class="language-javascript">        stud.<span class="property">value</span>.<span class="property">sex</span> = <span class="string">&quot;女&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">ageInc</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        stud.<span class="property">value</span>.<span class="property">age</span>++;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>既然如此，<code>ref</code> 和 <code>reactive</code>
在定义对象类型数据时有什么区别呢？其实，如果我们在控制台打印输出一下
<code>ref</code> 定义的对象类型数据就会立马看出它们之间的关联了：</p>
<p><img src="/img/vue3-03.png" /></p>
<p>从上图可以看出，当 <code>ref</code>
定义的是对象类型数据时，它会去请求 <code>reactive</code> 来帮忙，所以
RefImpl 对象上的属性 <code>value</code> 也变成了 Proxy
定义的对象。因此，如果 <code>reactive</code> 没有了，<code>ref</code>
也没法实现对象类型数据的响应式。</p>
<h3 id="ref-vs-reactive">3.4 ref vs reactive</h3>
<p>那么日常开发中到底使用 <code>ref</code> 还是 <code>reactive</code>
呢？虽然看起来 <code>ref</code> 使用起来要比 <code>reactive</code>
更加繁琐，但是 <code>ref</code> 也具有 <code>reactive</code>
不可比拟的优势，例如，<code>reactive</code>
定义的对象在重新赋值之后会失去响应式。看这个例子：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> &#123; reactive, ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> stud = <span class="title function_">reactive</span>(&#123;  <span class="comment">// 创建响应式对象</span></span></span><br><span class="line"><span class="language-javascript">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;王小明&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="string">&quot;age&quot;</span>: <span class="number">19</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="string">&quot;sex&quot;</span>: <span class="string">&quot;男&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="string">&quot;address&quot;</span>: <span class="string">&quot;浙江省杭州市xx区xx街xx号&quot;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;原本的对象：&quot;</span>, stud);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">changeStud</span>(<span class="params"></span>) &#123;  <span class="comment">// 为对象重新赋值</span></span></span><br><span class="line"><span class="language-javascript">        stud = &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;name&quot;</span>: <span class="string">&quot;荧姐&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;age&quot;</span>: <span class="number">19</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;sex&quot;</span>: <span class="string">&quot;女&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;address&quot;</span>: <span class="string">&quot;提瓦特大陆&quot;</span></span></span><br><span class="line"><span class="language-javascript">        &#125;;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;现在的对象：&quot;</span>, stud);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>学生信息：<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;a, b in stud&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;b&quot;</span>&gt;</span>&#123;&#123; b &#125;&#125;: &#123;&#123; a &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;a in stud&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;a&quot;</span>&gt;</span>&#123;&#123; a &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;changeStud&quot;</span>&gt;</span>改变信息<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>运行结果如下：</p>
<p><img src="/img/vue3-03.gif" /></p>
<p>可以看到，按钮点击之后，页面没有发生变化，但是通过控制台的打印信息可以发现，变量是被成功重新赋值了，但是新的变量并没有经过
Proxy 定义，所以不是响应式数据。</p>
<p>但是如果我们使用 <code>ref</code> 定义：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> &#123; reactive, ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> stud = <span class="title function_">ref</span>(&#123;  <span class="comment">// 创建响应式对象</span></span></span><br><span class="line"><span class="language-javascript">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;王小明&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="string">&quot;age&quot;</span>: <span class="number">19</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="string">&quot;sex&quot;</span>: <span class="string">&quot;男&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="string">&quot;address&quot;</span>: <span class="string">&quot;浙江省杭州市xx区xx街xx号&quot;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;原本的对象：&quot;</span>, stud);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">changeStud</span>(<span class="params"></span>) &#123;  <span class="comment">// 为对象重新赋值</span></span></span><br><span class="line"><span class="language-javascript">        stud.<span class="property">value</span> = &#123;       <span class="comment">// 注意访问ref定义的对象数据要用.value</span></span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;name&quot;</span>: <span class="string">&quot;荧姐&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;age&quot;</span>: <span class="number">19</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;sex&quot;</span>: <span class="string">&quot;女&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;address&quot;</span>: <span class="string">&quot;提瓦特大陆&quot;</span></span></span><br><span class="line"><span class="language-javascript">        &#125;;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;现在的对象：&quot;</span>, stud);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>结果如下：</p>
<p><img src="/img/vue3-04.gif" /></p>
<p>可以发现，即使被重新赋值，被 <code>ref</code>
定义的对象也仍然是响应式的。但是要注意，虽然 <code>ref</code>
定义的数据被赋值之后还能保持响应式，但这是有前提的，前提就是使用
<code>.value</code>，如果绕过了 <code>value</code>，直接去赋值，那结果跟
<code>reactive</code> 是一样的，响应式会消失。</p>
<p>不过，<code>reactive</code>
的这种缺点也不是不能克服的，当需要给对象重新赋值并且希望保留响应式时，可以使用
<code>Object.assign</code>
方法，该方法接收两个参数，第一个参数是原对象，第二个参数是要赋值的新对象：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> &#123; reactive, ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> stud = <span class="title function_">reactive</span>(&#123;  <span class="comment">// 创建响应式对象</span></span></span><br><span class="line"><span class="language-javascript">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;王小明&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="string">&quot;age&quot;</span>: <span class="number">19</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="string">&quot;sex&quot;</span>: <span class="string">&quot;男&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="string">&quot;address&quot;</span>: <span class="string">&quot;浙江省杭州市xx区xx街xx号&quot;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;原本的对象：&quot;</span>, stud);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">changeStud</span>(<span class="params"></span>) &#123;  <span class="comment">// 为对象重新赋值</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title class_">Object</span>.<span class="title function_">assign</span>(stud, &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;name&quot;</span>: <span class="string">&quot;荧姐&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;age&quot;</span>: <span class="number">19</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;sex&quot;</span>: <span class="string">&quot;女&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;address&quot;</span>: <span class="string">&quot;提瓦特大陆&quot;</span></span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;现在的对象：&quot;</span>, stud);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在开发中，到底是使用 <code>ref</code> 还是使用
<code>reactive</code>，可以遵循以下原则：</p>
<ol type="1">
<li>如果需要响应式基本类型数据，直接使用 <code>ref</code>。</li>
<li>如果需要响应式对象类型数据，且层级不深，<code>ref</code> 和
<code>reactive</code> 均可。</li>
<li>如果需要响应式对象类型数据，且层级较深，推荐使用
<code>reactive</code>。</li>
</ol>
<p>当然这个原则也不是绝对的，实际开发中按个人喜好来也没问题。</p>
<blockquote>
<p>总结 <code>ref</code> 和 <code>reactive</code> 的区别：</p>
<ol type="1">
<li><code>ref</code>
既可以定义基本类型数据的响应式，也可以定义对象类型数据的响应式。</li>
<li><code>ref</code>
定义的数据，不论是基本类型，还是对象类型，都必须加上
<code>.value</code>。</li>
<li><code>reactive</code>
定义的对象类型数据不可以直接整体赋值，赋值之后的对象不再是原本的对象，会失去响应式，页面内容不会改变，不过可以用
<code>Object.assign</code> 方法进行赋值来弥补这种缺点；但是
<code>ref</code>
定义的对象类型数据可以直接赋值，且不会失去响应式，页面内容也会跟着变。</li>
</ol>
</blockquote>
<h3 id="torefs-toref">3.5 toRefs &amp; toRef</h3>
<p>这两个 API 个人感觉作用不是很大，但是了解一下也好。解构赋值是 ES6
的新语法，它可以把一个对象中的属性拆解出来赋值给单个变量，例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> stud = &#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;xiaoming&quot;</span>,</span><br><span class="line">    <span class="string">&quot;age&quot;</span>: <span class="number">19</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> &#123;name, age&#125; = stud;</span><br></pre></td></tr></table></figure>
<p>如上，变量 name 和 age 将会继承 stud 对象上的 name 和 age
属性的值，这就是解构赋值。那么假设 stud 是一个 <code>reactive</code>
定义的响应式对象，使用解构赋值之后，改变 name 和 age 的值会影响到 stud
的值吗？页面上的内容会改变吗？直接说答案：不！解构赋值相当于是新建了两个变量，这两个变量只是得到了对象的属性值而已，跟对象无关。那么有没有办法使它们关联起来？当然是有的，这就是我们要介绍的
<code>toRefs</code>，我们可以把上述代码改成：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> &#123; reactive, toRefs &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> stud = <span class="title function_">reactive</span>(&#123;  <span class="comment">// 创建响应式对象</span></span></span><br><span class="line"><span class="language-javascript">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;王小明&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="string">&quot;age&quot;</span>: <span class="number">19</span></span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> &#123;name, age&#125; = <span class="title function_">toRefs</span>(stud);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">changeName</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        name.<span class="property">value</span> = <span class="string">&quot;空哥&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">ageInc</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        age.<span class="property">value</span>++;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>toRefs</code> 会将解构后的对象属性封装成一个
<code>objectRefImpl</code> 对象，这个对象与原来的对象相关联
(可以理解为指针)，改变其值会影响到响应式对象，而且会使页面刷新。</p>
<p><code>toRef</code> 的作用和 <code>toRefs</code> 是一样的，只不过
<code>toRef</code> 是一次只处理一个属性，例如我只需要获取 stud 对象上的
name 的响应式数据，就可以这么做：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> &#123; reactive, toRef &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> stud = <span class="title function_">reactive</span>(&#123;  <span class="comment">// 创建响应式对象</span></span></span><br><span class="line"><span class="language-javascript">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;王小明&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="string">&quot;age&quot;</span>: <span class="number">19</span></span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> name = <span class="title function_">toRef</span>(stud, <span class="string">&#x27;name&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="computed-计算属性">04 computed 计算属性</h2>
<h3 id="计算属性的用法">4.1 计算属性的用法</h3>
<p>假设我们希望实现如下效果：</p>
<p><img src="/img/vue3-05.gif" /></p>
<p>先来做需求分析：</p>
<ol type="1">
<li>页面内容受到用户行为影响发生变化，同时对应的数据要发生变化，即实现数据与页面之间的双向绑定，需要使用
<code>v-model</code>。</li>
<li>获取到用户输入后，要对用户输入进行处理
(首字母大写，加空格)，计算出新的数据，将新数据展示到页面上，需要用到<strong>计算属性</strong>。</li>
</ol>
<p>所谓计算属性，就是根据已有数据生成的新数据，它能随着源数据的改变而改变。在
vue2 中，计算属性通过配置项 <code>computed</code> 定义，而在 vue3
中，<code>computed</code>
变成了一个方法，其接收一个函数作为参数，该函数的返回值就是计算属性的值。由于在
vue3 的 setup 中已经不再需要
<code>this</code>，所以这个函数可以放心地写箭头函数。</p>
<p>上述效果的 js 代码可以这样写：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> &#123;ref, computed&#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> firstName = <span class="title function_">ref</span>(<span class="string">&quot;&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> lastName = <span class="title function_">ref</span>(<span class="string">&quot;&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> fullName = <span class="title function_">computed</span>(<span class="function">()=&gt;</span>&#123;  <span class="comment">// 创建计算属性，实现首字母大写，并在姓和名之间加上空格</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// slice方法对字符串进行切片，toUpperCase将字母转换为大写</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> n1 = firstName.<span class="property">value</span>.<span class="title function_">slice</span>(<span class="number">0</span>, <span class="number">1</span>).<span class="title function_">toUpperCase</span>() + firstName.<span class="property">value</span>.<span class="title function_">slice</span>(<span class="number">1</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> n2 = lastName.<span class="property">value</span>.<span class="title function_">slice</span>(<span class="number">0</span>, <span class="number">1</span>).<span class="title function_">toUpperCase</span>() + lastName.<span class="property">value</span>.<span class="title function_">slice</span>(<span class="number">1</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> n1 + <span class="string">&quot; &quot;</span> + n2;</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>补全模板 (注意 <code>v-model</code> 的使用)：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;firstName&quot;</span>&gt;</span>姓：<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;firstName&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;firstName&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;secondName&quot;</span>&gt;</span>名：<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;lastName&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;lastName&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>全名是: &#123;&#123; fullName &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>复习 <code>v-model</code>：</p>
<ol type="1">
<li><code>v-model</code> 将某个数据绑定到某个元素上，之后，该元素的
<code>value</code>
属性的变化将会影响到数据的变化，数据的变化也会影响到元素的变化，造成页面内容的改变，是一种双向数据绑定
(<code>v-bind</code> 是单向)。</li>
<li><code>v-model</code> 只能用在具有 <code>value</code>
属性的元素上，例如
<code>&lt;input&gt;</code>、<code>&lt;select&gt;</code>、<code>&lt;textarea&gt;</code>。</li>
</ol>
</blockquote>
<p>打开 vue
的浏览器开发插件，查看该组件所有的数据，你能发现如下内容：</p>
<p><img src="/img/vue3-04.png" /></p>
<p>firstName 和 lastName 都是 Ref 数据，而 fullName 是 Computed
数据，证明 fullName 的性质与 firstName 和 lastName 确实不一样。</p>
<p>计算属性的特点就是，==一旦它所依赖的数据发生变化，计算属性也会发生变化==。</p>
<h3 id="setter-和-getter">4.2 setter 和 getter</h3>
<p>如果我们在控制台打印一下 fullName 的值，我们会得到如下内容：</p>
<p><img src="/img/vue3-05.png" /></p>
<p>发现 fullName 是一个 <code>ComputedRefImpl</code> 对象，并且它和
<code>RefImpl</code> 一样有同样的结构，其中也有 <code>value</code>
这个属性。也就是说，假设我们要在 js 里访问 fullName 的值，也同样要加上
<code>.value</code>。那么问题来了：计算属性的值可不可以改变呢？也就是说我们可不可以写出
<code>fullName.value = xxx</code>
这种语句？答案是不可以！如果你这样写，编译器会提醒你计算属性的
<code>value</code>
值是一个只读属性，那么这是否意味着计算属性是不可修改的，只能依据源数据的改变而改变吗？答案也是否定的，这就要引出
<code>getter</code> 和 <code>setter</code> 了。</p>
<p><code>getter</code> 和 <code>setter</code>
是两个方法，其中，<code>getter</code>
是计算属性的计算方法，<code>setter</code>
是当计算属性被直接修改时要调用的方法。我们之前的计算属性的创建方式只是省略了
<code>setter</code>
的一种写法，如果写完整，那么计算属性应该这样创建：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> 属性名 = <span class="title function_">computed</span> (&#123;</span><br><span class="line">    <span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">return</span> 属性值;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">set</span>(<span class="params">val</span>) &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>也就是说，<code>computed</code> 方法其实是有两个参数的，第一个参数是
<code>get</code> 方法，第二个参数是 <code>set</code>
方法，只不过第二个参数可以省略，<code>set</code>
方法不设置，我们就无法修改计算属性的值。</p>
<p>当 <code>set</code> 方法被设置，我们就可以去使用
<code>fullName.value = xxx</code>
语句来对计算属性进行赋值，但是赋值不是直接进行的，这一行为只会引起
<code>set</code> 方法的调用，此时，赋值符号右边的 <code>xxx</code>
将会作为参数传到 <code>set</code>
方法中。计算属性是依赖于其他数据的数据，所以计算属性被修改，而其依赖数据不改变是不合适的，因此我们可以在
<code>set</code> 方法中去修改源数据，而修改源数据又会引起
<code>get</code>
方法的调用，从而达到修改计算属性的目的。下面是一个示例：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> &#123;ref, computed&#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> firstName = <span class="title function_">ref</span>(<span class="string">&quot;&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> lastName = <span class="title function_">ref</span>(<span class="string">&quot;&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> fullName = <span class="title function_">computed</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">get</span>(<span class="params"></span>) &#123;  <span class="comment">// getter</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">let</span> n1 = firstName.<span class="property">value</span>.<span class="title function_">slice</span>(<span class="number">0</span>, <span class="number">1</span>).<span class="title function_">toUpperCase</span>() + firstName.<span class="property">value</span>.<span class="title function_">slice</span>(<span class="number">1</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">let</span> n2 = lastName.<span class="property">value</span>.<span class="title function_">slice</span>(<span class="number">0</span>, <span class="number">1</span>).<span class="title function_">toUpperCase</span>() + lastName.<span class="property">value</span>.<span class="title function_">slice</span>(<span class="number">1</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> n1 + <span class="string">&quot; &quot;</span> + n2;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">set</span>(<span class="params">val</span>) &#123;  <span class="comment">// setter</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">let</span> [f, l] = val.<span class="title function_">split</span>(<span class="string">&quot; &quot;</span>);</span></span><br><span class="line"><span class="language-javascript">            firstName.<span class="property">value</span> = f;</span></span><br><span class="line"><span class="language-javascript">            lastName.<span class="property">value</span> = l;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">changeFullName</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        fullName.<span class="property">value</span> = <span class="string">&quot;li xiaolang&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;firstName&quot;</span>&gt;</span>姓：<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;firstName&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;firstName&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;secondName&quot;</span>&gt;</span>名：<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;lastName&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;lastName&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>全名是: &#123;&#123; fullName &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;confirm&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;changeFullName&quot;</span>&gt;</span>更改全名为LiXiaolang<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>效果：</p>
<p><img src="/img/vue3-06.gif" /></p>
<h2 id="watch-监视">05 watch 监视</h2>
<p>Vue3 中 <code>watch</code> 这个 API 的作用跟 vue2
是一样的，就是==监视数据的变化==。Vue 的官网明确了 <code>watch</code>
能监视的四种数据：</p>
<ol type="1">
<li><code>ref</code> 定义的数据。</li>
<li><code>reactive</code> 定义的数据。</li>
<li><code>getter</code> 函数的返回值。</li>
<li>由上述数据组成的数组。</li>
</ol>
<p>虽然 <code>watch</code> 能监视的数据类型是 4
种，但是实际使用中我们能遇到 5 种情况，下面逐一介绍。</p>
<h3 id="情况一ref-定义的基本类型数据">5.1 情况一：ref
定义的基本类型数据</h3>
<p>在 Vue3 中，<code>watch</code> 是一个函数，其基本使用方法为：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">watch</span>(要监视的数据, <span class="function">(<span class="params">newValue, oldValue</span>)=&gt;</span>&#123;  <span class="comment">// 接收两个参数，第一个是要监视的数据，第二个是一个回调函数</span></span><br><span class="line">    ...</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>当被监视的数据发生变化时，回调函数就会被调用，并且新值和旧值会作为参数被传入。下面是一个例子：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">	<span class="keyword">import</span> &#123;ref, watch&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">	<span class="keyword">let</span> age = <span class="title function_">ref</span>(<span class="number">18</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">watch</span>(age, <span class="function">(<span class="params">newValue, oldValue</span>)=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;age变化了&quot;</span>, <span class="string">&quot;新值：&quot;</span>, newValue, <span class="string">&quot; 旧值：&quot;</span>, oldValue);</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">	<span class="keyword">function</span> <span class="title function_">ageInc</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">		age.<span class="property">value</span> += <span class="number">1</span>;</span></span><br><span class="line"><span class="language-javascript">	&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">p</span>&gt;</span>年龄：&#123;&#123; age &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;ageInc&quot;</span>&gt;</span>增加年龄<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>效果：</p>
<p><img src="/img/vue3-07.gif" /></p>
<p>这里要注意的一件事是：<code>watch</code> 的第一个参数要传变量，不要加
<code>.value</code>。</p>
<hr />
<p>如何停止监视？</p>
<p><code>watch</code>
有返回值，该返回值是一个函数，通过调用该函数，我们可以解除监视。假设有需求：当
age 增加到 22 就不再进行监视，那么我们可以这样写：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">	<span class="keyword">import</span> &#123;ref, watch&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">	<span class="keyword">let</span> age = <span class="title function_">ref</span>(<span class="number">18</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> stopWatch = <span class="title function_">watch</span>(age, <span class="function">(<span class="params">newValue, oldValue</span>)=&gt;</span>&#123;  <span class="comment">// 将watch的返回值接住</span></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;age变化了&quot;</span>, <span class="string">&quot;新值：&quot;</span>, newValue, <span class="string">&quot; 旧值：&quot;</span>, oldValue);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (newValue &gt;= <span class="number">22</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">stopWatch</span>();  <span class="comment">// 调用stopWatch</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">	<span class="keyword">function</span> <span class="title function_">ageInc</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">		age.<span class="property">value</span> += <span class="number">1</span>;</span></span><br><span class="line"><span class="language-javascript">	&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这样就会得到：</p>
<p><img src="/img/vue3-08.gif" /></p>
<h3 id="情况二ref-定义的对象类型数据">5.2 情况二：ref
定义的对象类型数据</h3>
<p>对象类型数据的监视稍有特殊，先来看结果，我们定义一个对象，该对象上有两个属性，我们再定义三个按钮，三个按钮的作用分别是修改对象的两个属性及对象整体的值，代码如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">	<span class="keyword">import</span> &#123;ref, watch&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> stud = <span class="title function_">ref</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">name</span>: <span class="string">&quot;王小明&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">age</span>: <span class="number">15</span></span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">watch</span>(stud, <span class="function">(<span class="params">newValue, oldValue</span>)=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;对象被修改了&quot;</span>, newValue, oldValue);</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">ageInc</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">		stud.<span class="property">value</span>.<span class="property">age</span>++;</span></span><br><span class="line"><span class="language-javascript">	&#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">changeName</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        stud.<span class="property">value</span>.<span class="property">name</span> += <span class="string">&quot;~&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">changeAll</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        stud.<span class="property">value</span> = &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">name</span>: <span class="string">&quot;李小狼&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">age</span>: <span class="number">20</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>姓名：&#123;&#123; stud.name &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">p</span>&gt;</span>年龄：&#123;&#123; stud.age &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">button</span> <span class="attr">style</span>=<span class="string">&quot;margin-right: 2px;&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;ageInc&quot;</span>&gt;</span>增加年龄<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">style</span>=<span class="string">&quot;margin-right: 2px;&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;changeName&quot;</span>&gt;</span>修改姓名<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">style</span>=<span class="string">&quot;margin-right: 2px;&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;changeAll&quot;</span>&gt;</span>更改整个对象<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>我们将得到以下效果：</p>
<p><img src="/img/vue3-09.gif" /></p>
<p>可以发现，当一个对象被监视时，对象上的属性发生改变都不会引起
<code>watch</code>
的注意，但是当对象整体被重新赋值时，<code>watch</code>
就出动了，也就是说 <code>wacth</code>
监视对象时，它监视的是对象的地址。</p>
<p>如果想要 <code>wacth</code>
能够监视到对象的属性值的变化，就需要开启<strong>深度监视</strong>，开启的方式在于
<code>watch</code> 的第三个参数。<code>watch</code>
的第三个参数是一个对象，用于传入各种配置项，其中有一个属性就叫
<code>deep</code>，当该属性被设置为
<code>true</code>，深度监视就会开启，<code>watch</code>
将能检测到对象属性值的改变。所以我们将逻辑代码重写为：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">watch</span>(stud, <span class="function">(<span class="params">newValue, oldValue</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;对象被修改了&quot;</span>, newValue, oldValue);</span><br><span class="line">&#125;, &#123;<span class="attr">deep</span>: <span class="literal">true</span>&#125;);  <span class="comment">// 开启深度监视</span></span><br></pre></td></tr></table></figure>
<p>此时，页面的展示效果就会变成：</p>
<p><img src="/img/vue3-10.gif" /></p>
<p>但是注意，这里有一个
bug，仔细观察上面控制台输出的内容，你会发现，当对象属性被修改时，传入回调函数的两个参数
—— newValue 和 oldValue 是一样的，只有当对象整体被修改时，newValue 和
oldValue 才不一样。这个 bug 其实自 vue2
起就存在了，不过由于大多数情况下我们都不需要去管
oldValue，不影响正常使用，所以问题不大，就算回调函数中只写一个参数也是没问题的。</p>
<h3 id="情况三reactive-定义的对象类型数据">5.3 情况三：reactive
定义的对象类型数据</h3>
<p><code>watch</code> 用在 <code>reactive</code>
定义的对象类型数据时，造成的效果与
<code>ref</code>，也就是情况二<strong>正好相反</strong>。当
<code>wacth</code> 发现要监视的对象是由 <code>reactive</code>
定义的时，就会<u>自动开启</u>深度监视，并且，根据之前所学的知识，<code>reactive</code>
定义的对象数据不支持整体赋值，所以直接改变 <code>reactive</code>
定义的对象反而不会被监视到。看下面这个例子：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">	<span class="keyword">import</span> &#123;reactive, ref, watch&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> stud = <span class="title function_">reactive</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">name</span>: <span class="string">&quot;王小明&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">age</span>: <span class="number">15</span></span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">watch</span>(stud, <span class="function">(<span class="params">newValue, oldValue</span>)=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;对象被修改了&quot;</span>, newValue, oldValue);</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">ageInc</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">		stud.<span class="property">age</span>++;</span></span><br><span class="line"><span class="language-javascript">	&#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">changeName</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        stud.<span class="property">name</span> += <span class="string">&quot;~&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">changeAll</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        stud = &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">name</span>: <span class="string">&quot;李小狼&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">age</span>: <span class="number">20</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>姓名：&#123;&#123; stud.name &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">p</span>&gt;</span>年龄：&#123;&#123; stud.age &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">button</span> <span class="attr">style</span>=<span class="string">&quot;margin-right: 2px;&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;ageInc&quot;</span>&gt;</span>增加年龄<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">style</span>=<span class="string">&quot;margin-right: 2px;&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;changeName&quot;</span>&gt;</span>修改姓名<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">style</span>=<span class="string">&quot;margin-right: 2px;&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;changeAll&quot;</span>&gt;</span>更改整个对象<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>效果：</p>
<p><img src="/img/vue3-11.gif" /></p>
<p>可以发现，当对象被整体改变时，对象地址发生了改变，对象失去了响应式，断开了与页面的联系，并且
<code>watch</code> 也监视不到了。</p>
<p>但是如果我们使用 <code>Object.assign</code>
方法来改变对象的整体值，那么情况就会大不一样：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">changeAll</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">assign</span>(stud, &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;李小狼&quot;</span>,</span><br><span class="line">        <span class="attr">age</span>: <span class="number">20</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果：</p>
<p><img src="/img/vue3-12.gif" /></p>
<blockquote>
<p>总结：监视 <code>reactive</code>
定义的对象时，默认开启深度监视，而且这个深度监视无法通过配置项进行关闭。</p>
</blockquote>
<h3 id="情况四监视对象上的某个值">5.4 情况四：监视对象上的某个值</h3>
<p>上面展示的例子都是监视整个对象，那么如果现在我们只需要监视一个对象上的某个属性呢？这就是情况四，不过，根据属性值类型的不同，还要分成两种情况：</p>
<ol type="1">
<li>属性值是基本类型数据。</li>
<li>属性值是对象类型数据。</li>
</ol>
<p>为了方便演示，我们先定义一下演示要用的例子：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">	<span class="keyword">import</span> &#123;reactive, ref, watch&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> person = <span class="title function_">reactive</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">name</span>: <span class="string">&quot;王小明&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">age</span>: <span class="number">15</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">cars</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">c1</span>: <span class="string">&quot;宝马&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">c2</span>: <span class="string">&quot;奥迪&quot;</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">watch</span>(person, <span class="function">(<span class="params">newValue, oldValue</span>)=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;对象被修改了&quot;</span>, newValue, oldValue);</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">ageInc</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">		person.<span class="property">age</span>++;</span></span><br><span class="line"><span class="language-javascript">	&#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">changeName</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        person.<span class="property">name</span> += <span class="string">&quot;~&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">changeC1</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        person.<span class="property">cars</span>.<span class="property">c1</span> = <span class="string">&quot;大众&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">changeC2</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        person.<span class="property">cars</span>.<span class="property">c2</span> = <span class="string">&quot;奔驰&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>姓名：&#123;&#123; person.name &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">p</span>&gt;</span>年龄：&#123;&#123; person.age &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>第一辆车：&#123;&#123; person.cars.c1 &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>第二辆车：&#123;&#123; person.cars.c2 &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">button</span> <span class="attr">style</span>=<span class="string">&quot;margin-right: 2px;&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;ageInc&quot;</span>&gt;</span>增加年龄<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">style</span>=<span class="string">&quot;margin-right: 2px;&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;changeName&quot;</span>&gt;</span>修改姓名<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">style</span>=<span class="string">&quot;margin-right: 2px;&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;changeC1&quot;</span>&gt;</span>修改第一辆车<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">style</span>=<span class="string">&quot;margin-right: 2px;&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;changeC2&quot;</span>&gt;</span>修改第二辆车<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>上例中，我们监视的仍然是对象的整体，所以修改对象上的任何一个属性，都会被监视到：</p>
<p><img src="/img/vue3-13.gif" /></p>
<h4 id="基本类型属性">5.4.1 基本类型属性</h4>
<p>现在，我们需求是：只监视 person
对象上的年龄属性，其他属性都不监视，我们需要这样写监视函数：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">watch</span>(<span class="function">()=&gt;</span>&#123;<span class="keyword">return</span> person.<span class="property">age</span>&#125;, <span class="function">(<span class="params">newValue, oldValue</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;对象被修改了&quot;</span>, newValue, oldValue);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>注意，此时，<code>watch</code>
的第一个参数不再是对象本身，而是一个函数，这就是我们之前说的
<code>watch</code> 可监视函数返回值。每当对象被修改，<code>watch</code>
就根据这个函数的返回值来判断要不要调用监视函数，这样一来，只要
person.age 不发生改变，<code>watch</code>
就不会调用监视函数。换句话来说，这样就实现了只监视对象上的某一属性。作出上述修改后，页面的效果就会变成：</p>
<p><img src="/img/vue3-14.gif" /></p>
<p>另外，由于这里我们所写的箭头函数只有一个 <code>return</code>
语句，所以可以进一步简写为：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">watch</span>(<span class="function">()=&gt;</span>person.<span class="property">age</span>, <span class="function">(<span class="params">newValue, oldValue</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;对象被修改了&quot;</span>, newValue, oldValue);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="对象类型属性">5.4.2 对象类型属性</h4>
<p>如果我们只需要监视对象上的某个属性，而且这个属性又是一个对象，那么我们有两种监视的方法，先介绍第一种
—— 直接监视这个对象属性，例如我们要监视上例中的
person.cars，代码可以这么写：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">watch</span>(stud.<span class="property">cars</span>, <span class="function">(<span class="params">newValue, oldValue</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;对象被修改了&quot;</span>, newValue, oldValue);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>效果为：</p>
<p><img src="/img/vue3-15.gif" /></p>
<blockquote>
<p>但是注意：如果属性值是基本类型不能这样写，会报错，必须按 5.4.1
所讲的方法进行设置。</p>
</blockquote>
<p>不过这样做有个<strong>弊端</strong>，那就是==当 person.cars
被整体替换，也就是有语句 <code>persons.cars = &#123;xxx&#125;</code>
时，监视就不再起作用了==：</p>
<p><img src="/img/vue3-16.gif" /></p>
<p>那有什么解决方法吗？一种方法是使用
<code>Object.assign</code>，因为这个方法本质上是修改属性值，不会替换整个对象；另一种方法就是
<code>watch</code> 的另一种写法 —— 监视一个函数的返回值，也就是使用同
5.4.1 一样的写法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">watch</span>(<span class="function">()=&gt;</span>person.<span class="property">cars</span>, <span class="function">(<span class="params">newValue, oldValue</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;对象被修改了&quot;</span>, newValue, oldValue);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>这样一来，当对象整体被替换，<code>watch</code>
照样能监视，不过这种写法同样有<strong>弊端</strong>，那就是修改属性对象上的某个值时，它又监视不到了，和前一种方法正好相反：</p>
<p><img src="/img/vue3-17.gif" /></p>
<p>但是好在这种弊端可以通过开启<strong>深度监视</strong>来解决：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">watch</span>(<span class="function">()=&gt;</span>person.<span class="property">cars</span>, <span class="function">(<span class="params">newValue, oldValue</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;对象被修改了&quot;</span>, newValue, oldValue);</span><br><span class="line">&#125;, &#123;<span class="attr">deep</span>: <span class="literal">true</span>&#125;);</span><br></pre></td></tr></table></figure>
<p>效果：</p>
<p><img src="/img/vue3-18.gif" /></p>
<blockquote>
<p>总结：当需要监视对象上的某个属性值时，如果要监视的属性是基本类型，那么使用函数式；如果要监视的属性是对象类型，函数式或变量均可，但是推荐使用函数式，但是函数式只能监视到地址的变化，如果需要监视到细枝末节的变化
(对象上的某一属性发生改变) 就需要开启深度监视。</p>
</blockquote>
<h3 id="情况五监视对象上的某些值">5.5 情况五：监视对象上的某些值</h3>
<p>如果我们想一次性监视对象上的多个值该怎么做？一个个去绑定？这样太繁琐，更简单的方式是使用数组，例如我们需要监视
person 对象上的 age、c1 这两个属性，那么我们可以这样写：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">watch</span>([<span class="function">()=&gt;</span>person.<span class="property">age</span>, <span class="function">()=&gt;</span>person.<span class="property">cars</span>.<span class="property">c1</span>], <span class="function">(<span class="params">newValue, oldValue</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;对象被修改了&quot;</span>, newValue, oldValue);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>这样以来，我们就只监视了 person 上的两个属性：</p>
<p><img src="/img/vue3-19.gif" /></p>
<h3 id="watcheffect">5.6 watchEffect</h3>
<p>假设我们有一个需求：当检测到水温达到 60℃，或者水位达到 50cm
时，就向服务器发送请求，那么基于我们上面所学的知识，我们要做的就是对水温和水位这两个变量进行监视，在回调函数中写一个
<code>if</code>
语句来进行逻辑判断。这样写的一个弊端是：如果涉及到的变量很多，例如这里只涉及到水温和水位两个，但万一遇到十几个，那么岂不是要监视很多变量，<code>watch</code>
的参数列表长度会变得很长，这是我们不希望看到的。这个时候，<code>watchEffect</code>
就派上用场了。</p>
<p><code>watchEffect</code>：立即运行一个函数，同时响应式地追踪其依赖，并在依赖更改时重新执行该函数。</p>
<p><code>watchEffect</code> 可以看作是 <code>watch</code>
的全自动版，它不需要用户指定要监视的变量，而是可以根据用户写的回调函数去猜要监视哪些变量，例如为了应对上面的需求，我们就可以这样写：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;ref, watchEffect&#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> sw = <span class="title function_">ref</span>(<span class="number">0</span>);  <span class="comment">// 表示水位</span></span><br><span class="line"><span class="keyword">let</span> wd = <span class="title function_">ref</span>(<span class="number">0</span>);  <span class="comment">// 表示温度</span></span><br><span class="line"><span class="title function_">watchEffect</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (wd.<span class="property">value</span> &gt;= <span class="number">60</span> || sw.<span class="property">value</span> &gt;= <span class="number">50</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;发送请求&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>这样，当 wd 或 sw 被修改时，监视函数就会立刻被调用：</p>
<p><img src="/img/vue3-20.gif" /></p>
<p>要注意一点是，<code>watchEffect</code>
会在一开始就调用一次回调函数，也就是说即使一开始变量没发生改变，回调函数也会被调用一次，相当于是
<code>immediate</code> 配置项被设为 <code>true</code> 的
<code>watch</code>。</p>
<h2 id="标签的-ref-属性">06 标签的 ref 属性</h2>
<p>本节重点：<code>ref</code> 标记、<code>defineExpose</code> 方法。</p>
<h3 id="ref-属性">6.1 ref 属性</h3>
<p>虽然 vue 中的组件是分散开的，写在一个个 <code>.vue</code>
文件中，但是最终渲染的时候，所有组件还是会被封装到一起去，大多数时候都是一大群人开发一个项目，每个人负责写一部分组件，这就会导致一个问题：组件
id 有可能会重复，完全有可能出现两个人或多个人给各自的标签用了同一个 id
的情况，这是我们不希望出现的。</p>
<p>举个例子，假设 App 组件中，我们给一个标签设置 id 为 title：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">	<span class="keyword">import</span> <span class="title class_">Person</span> <span class="keyword">from</span> <span class="string">&quot;./components/Person.vue&quot;</span>;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">h1</span> <span class="attr">id</span>=<span class="string">&quot;title&quot;</span>&gt;</span>你好<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">Person</span>&gt;</span><span class="tag">&lt;/<span class="name">Person</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>然后，我们在引入的 Person.vue 中写入如下内容，同样给一个标签设置 id
为 title，并且在控制台输出一下 id 为 title 的 DOM 元素：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;title&quot;</span>));</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">h1</span> <span class="attr">id</span>=<span class="string">&quot;title&quot;</span>&gt;</span>今天天气真好<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>得到控制台的输出为：</p>
<p><img src="/img/vue3-06.png" /></p>
<p>我们会发现，虽然我们是在 Person.vue 里使用了
<code>getElementById("title")</code>，但是获取到的 DOM 元素却是 App.vue
中的 <code>&lt;h1&gt;</code> 标签，这是因为 App.vue
中的内容先于子组件被渲染。可见，id 冲突会带来很大的麻烦。</p>
<p>为了解决这个问题，vue 提供了 ref 属性，用来代替 id，将 id 改为 ref
之后，我们可以用这种方式来获取对应的 DOM 元素：</p>
<p>Person.vue：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">	<span class="keyword">import</span> &#123;ref&#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> title = <span class="title function_">ref</span>();</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">getTitle</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(title.<span class="property">value</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">h1</span> <span class="attr">ref</span>=<span class="string">&quot;title&quot;</span>&gt;</span>今天天气真好<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;getTitle&quot;</span>&gt;</span>点我获取title<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>App.vue：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">	<span class="keyword">import</span> &#123;ref&#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> title = <span class="title function_">ref</span>();</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">getTitle</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(title.<span class="property">value</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">h1</span> <span class="attr">ref</span>=<span class="string">&quot;title&quot;</span>&gt;</span>你好<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;getTitle&quot;</span>&gt;</span>点我获取App中的title<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">Person</span>&gt;</span><span class="tag">&lt;/<span class="name">Person</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>没错，就是这么简单。<code>ref</code>
在不传入任何参数的时候，就会去寻找 DOM
元素，并且，我们的==变量名必须与要寻找的 DOM 元素的 ref
属性相同==才行。这样得到的效果为：</p>
<p><img src="/img/vue3-21.gif" /></p>
<blockquote>
<p>这里要注意：ref
标记的标签不能直接获取，要像上面一样写成按钮的点击事件，否则将输出
<code>undefined</code>，猜测原因是直接写在 js 环境中，js 代码会在 vue
还没有处理 ref 标记前被执行。</p>
</blockquote>
<h3 id="defineexpose">6.2 defineExpose</h3>
<p>现在考虑这样一种情况：如果我们给组件标签加上 ref
标签会怎么样？会返回组件的 DOM 元素吗？如果会，那我们能通过组件的 DOM
元素去访问组件下的全部数据吗？先说答案：可以，但是无法访问子组件数据。</p>
<p>我们现在给 Person 组件加上 ref 标记：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">	<span class="keyword">import</span> <span class="title class_">Person</span> <span class="keyword">from</span> <span class="string">&quot;./components/Person.vue&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">	<span class="keyword">import</span> &#123;ref&#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> title = <span class="title function_">ref</span>();</span></span><br><span class="line"><span class="language-javascript">	<span class="keyword">let</span> test = <span class="title function_">ref</span>();  <span class="comment">// 获取Person组件的DOM元素</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">getTitle</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(title.<span class="property">value</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">	<span class="keyword">function</span> <span class="title function_">getPerson</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">		<span class="variable language_">console</span>.<span class="title function_">log</span>(test.<span class="property">value</span>);</span></span><br><span class="line"><span class="language-javascript">	&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">h1</span> <span class="attr">ref</span>=<span class="string">&quot;title&quot;</span>&gt;</span>你好<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;getTitle&quot;</span>&gt;</span>点我获取App中的title<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">Person</span> <span class="attr">ref</span>=<span class="string">&quot;test&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">Person</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;getPerson&quot;</span>&gt;</span>点我获取Person组件<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>同时，我们在 Person.vue 中新建几个数据：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">	<span class="keyword">import</span> &#123;ref&#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> title = <span class="title function_">ref</span>();</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">getTitle</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(title.<span class="property">value</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> a = <span class="title function_">ref</span>(<span class="number">0</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> b = <span class="title function_">ref</span>(<span class="number">1</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> c = <span class="title function_">ref</span>(<span class="number">2</span>);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">h1</span> <span class="attr">ref</span>=<span class="string">&quot;title&quot;</span>&gt;</span>今天天气真好<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;getTitle&quot;</span>&gt;</span>点我获取Person中的title<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>控制台输出的内容为：</p>
<p><img src="/img/vue3-07.png" /></p>
<p>虽然控制台正确输出了 Person 组件的对象，但是其中并没有任何与 Person
中数据有关的信息。这是 vue 的保密措施，虽说 Person 是 App
的子组件，但这并不意味着父组件就拥有访问子组件的全部数据的权限。如果需要使子组件向父组件展示数据，让父组件可以通过子组件的对象来访问子组件中的数据，就要借助一个
API —— <code>defineExpose</code>。</p>
<p>其使用方法为：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;defineExpose&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">let</span> a = <span class="title function_">ref</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">let</span> b = <span class="title function_">ref</span>(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">let</span> c = <span class="title function_">ref</span>(<span class="number">2</span>);</span><br><span class="line"><span class="title function_">defineExpose</span>(&#123;a, b, c&#125;);</span><br></pre></td></tr></table></figure>
<p>这样一来，我们再来看看控制台输出的内容：</p>
<p><img src="/img/vue3-08.png" /></p>
<p>可以看到，现在 Person 组件的对象中就出现了 a、b、c
三个数据的信息了。</p>
<h2 id="props">07 props</h2>
<h3 id="props-的使用">7.1 props 的使用</h3>
<p>当父组件需要给子组件传值的时候，<code>props</code> 就派上用场了。</p>
<p>先来看看父组件如何给子组件传值，如果父组件要给子组件传值，只需要在子组件的标签上加一个属性即可，属性名就是要传过去的数据的名字，属性值就是要传过去的值：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">	<span class="keyword">import</span> <span class="title class_">Student</span> <span class="keyword">from</span> <span class="string">&#x27;./components/Student.vue&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">Student</span> <span class="attr">name</span>=<span class="string">&quot;李小狼&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">Student</span>&gt;</span>  // 传值</span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>子组件中，可以通过 <code>defineProps</code>
函数来进行接收，该函数接收一个列表，列表中为要接收的变量名称，且为字符串：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> &#123; defineProps &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">defineProps</span>([<span class="string">&#x27;name&#x27;</span>]);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>姓名：&#123;&#123; name &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>如此一来，子组件中就能正常展示父组件传来的数据了：</p>
<p><img src="/img/vue3-09.png" /></p>
<p>但是这还不够，虽然在 <code>template</code> 中可以顺利访问到
name，但是在 <code>script</code>
中是访问不到的，毕竟变量都没有创建，直接访问肯定会出错，那么如何在 js
中保存传过来的数据呢？<code>defineProps</code>
函数是有返回值的，返回值就是封装了所有引入数据的<strong>对象</strong>，我们可以打印一下
<code>defineProps</code> 的返回值：</p>
<p><img src="/img/vue3-10.png" /></p>
<p>假设现在父组件不再传简单的基本类型数据，而是对象类型数据：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">	<span class="keyword">import</span> <span class="title class_">Student</span> <span class="keyword">from</span> <span class="string">&#x27;./components/Student.vue&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">	<span class="keyword">let</span> person = &#123;</span></span><br><span class="line"><span class="language-javascript">		<span class="attr">name</span>: <span class="string">&quot;小樱&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">		<span class="attr">sex</span>: <span class="string">&quot;女&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">		<span class="attr">age</span>: <span class="string">&quot;15&quot;</span></span></span><br><span class="line"><span class="language-javascript">	&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">Student</span> <span class="attr">name</span>=<span class="string">&quot;李小狼&quot;</span> <span class="attr">:person</span>=<span class="string">&quot;person&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">Student</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>注意：这里必须要在属性名前加上 <code>:</code>，因为只有加上
<code>:</code>，vue
才会将等号后面的内容当作表达式去处理。随后只要在子组件中正确接收数据就可以了：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> &#123; defineProps &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> x = <span class="title function_">defineProps</span>([<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;person&#x27;</span>]);</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(x);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>姓名：&#123;&#123; person.name &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>性别：&#123;&#123; person.sex &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>年龄：&#123;&#123; person.age &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>页面效果：</p>
<p><img src="/img/vue3-11.png" /></p>
<p>同时，由于我们在 js 中用变量 x
接收了父组件传过来的所有数据，所以也可以用 x 来进行访问：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> &#123; defineProps &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> x = <span class="title function_">defineProps</span>([<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;person&#x27;</span>]);</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(x);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>姓名：&#123;&#123; x.person.name &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>性别：&#123;&#123; x.person.sex &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>年龄：&#123;&#123; x.person.age &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>总之显示效果是一样的就是了。</p>
<h3 id="类型限制">7.2 类型限制</h3>
<p>上面介绍的方法有一个缺点：父组件给我们的数据是什么类型的我们是不知道的，例如，我们需要一个列表，但是父组件却给了我们一个数字，那么页面可能就会出错，那么有没有办法对传过来的数据进行类型限制呢？这里就要用到
ts 中的泛型了。</p>
<p>TypeScript
的内容在这里就不过多展开了，有兴趣请自行了解，这里只介绍如何对
<code>props</code> 的类型做出限制：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">defineProps&lt;&#123;变量名<span class="number">1</span>:数据类型, 变量名<span class="number">2</span>:数据类型&#125;&gt;();</span><br></pre></td></tr></table></figure>
<p>假设父组件给我们一个 name
数据，子组件希望这个数据是字符串类型的，那么就可以这么写：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">defineProps&lt;&#123;<span class="attr">name</span>: <span class="built_in">string</span>&#125;&gt;();</span><br></pre></td></tr></table></figure>
<p>这个时候，假如父组件给我们的数据是其他类型，比如说数字，那么就会飘红：</p>
<p><img src="/img/vue3-12.png" /></p>
<blockquote>
<p>这里为什么要在 name 属性前加 <code>:</code>？因为只有加了
<code>:</code>
才会将后面的内容当作表达式执行，如果不加，那传过去的就只是一个字符串类型的
<code>1</code>。</p>
</blockquote>
<h3 id="必要性限制">7.3 必要性限制</h3>
<p>假如和上面一样，子组件中已经对 name 做出了类型限制：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">defineProps&lt;&#123;<span class="attr">name</span>: <span class="built_in">string</span>&#125;&gt;();</span><br></pre></td></tr></table></figure>
<p>那么要注意，不仅类型不对会飘红，父组件不传该值也会飘红：</p>
<p><img src="/img/vue3-13.png" /></p>
<p>相当于说，上面这种写法不仅对数据类型做了限制，对数据的必要性也做了限制，那么如何设置一个可选的数据，使得就算父组件不传也不会报错呢？很简单，方法就是在变量名后面加个问号
<code>?</code>：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">defineProps&lt;&#123;<span class="attr">name</span>?: <span class="built_in">string</span>&#125;&gt;();</span><br></pre></td></tr></table></figure>
<p>这样一来上面的报错就消失了。不仅如此，我们还可以为可选数据设置默认值，这要用到另一个
API —— <code>withDefaults</code>，比如说为 name 设置一个默认值：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">withDefaults</span>(defineProps&lt;&#123;<span class="attr">name</span>?: <span class="built_in">string</span>&#125;&gt;(), &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="function">()=&gt;</span><span class="string">&quot;木之本樱&quot;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="生命周期">08 生命周期</h2>
<h3 id="vue3-的生命周期">8.1 Vue3 的生命周期</h3>
<p>下面是官方给出的 vue3 生命周期图：</p>
<p><img src="/img/vue3-14.png" /></p>
<p>生命周期，说白了，就是 vue 构建、更新和销毁的过程。在每个阶段，vue
都会去调用一些特定的函数，这些函数我们称之为<strong>生命周期函数</strong>，也称为<strong>钩子</strong>。我们可以利用这些函数，在每个阶段做一些特别的事情。上图中红框中标出的，就是
vue3 中的生命周期中的各个阶段。</p>
<p>Vue3 中的第一个生命周期钩子是
<code>setup</code>，这个其实是老朋友了，我们已经用了很久了。从上图中可以看出，<code>setup</code>
在 <code>beforeCreate</code> 之前被调用，说明 <code>setup</code>
被调用的时候，vue 的构建都还没正式开始呢。所以我们说，<code>setup</code>
里没有 <code>this</code> 了。</p>
<p><code>beforeCreate</code> 是 vue3 的第二个生命阶段，此时 vue
仍为开始构建实例化对象。</p>
<p><code>created</code> 是 vue3 的第三个生命阶段，此时 vue
对象构建完成，<code>this</code> 已经存在，并且已经将 <code>setup</code>
中我们设置的数据、函数等都已经配置好了。</p>
<p>之后就是
<code>beforeMounte</code>，这一步称为挂载之前，所谓挂载就是指将编译好的模板渲染到页面上去的过程。在
<code>beforeMounte</code> 中，页面展示的是还未经编译的结构，我们对 DOM
元素做出的任何修改都不作数。</p>
<p>在 <code>mounted</code>
之后，页面就已经渲染完成了，能够正常显示，之后如果我们对页面做出任何修改，比如响应式数据发生改变，都会导致页面更新，这时就会进入
<code>beforeUpdate</code> 和 <code>updated</code>
这两个生命阶段，且这两个生命阶段可能被重复数次。</p>
<p>最后就是 vue 对象的销毁，需要将页面“卸载”，也就是
<code>beforeUnmount</code> 和 <code>unmounted</code>
阶段，在这里我们可以做一些善后工作。</p>
<h3 id="生命周期钩子的使用">8.2 生命周期钩子的使用</h3>
<p>上面介绍了 vue3
的生命周期，但是生命周期函数的名称并不是那也一一对应，vue3
对生命周期做出了一些调整，例如在 vue2 中，还存在
<code>beforeCreate</code> 和 <code>onCreated</code> 这两个钩子，但是在
vue3 中这两个钩子都没了，直接用一个 <code>setup</code> 就替代了；再比如
vue2 中最后一个阶段叫销毁 (destroy)，但在 vue3 中变成了卸载
(unmount)。所以就有了下面这张表格：</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">阶段</th>
<th style="text-align: center;">钩子</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">创建</td>
<td style="text-align: center;"><code>setup</code></td>
</tr>
<tr class="even">
<td style="text-align: center;">挂载 (之前，之后)</td>
<td
style="text-align: center;"><code>onBeforeMount</code>、<code>onMounted</code></td>
</tr>
<tr class="odd">
<td style="text-align: center;">更新 (之前，之后)</td>
<td
style="text-align: center;"><code>onBeforeUpdate</code>、<code>onUpdated</code></td>
</tr>
<tr class="even">
<td style="text-align: center;">卸载 (之前，之后)</td>
<td
style="text-align: center;"><code>onBeforeUnmount</code>、<code>onUnmounted</code></td>
</tr>
</tbody>
</table>
<p>==每个钩子都接收一个回调函数作为参数，当进入特定生命阶段时，就会调用该钩子接收到的回调函数。==</p>
<p>为了演示每个钩子的调用时机，我们在父组件中用 <code>v-if</code>
来控制子组件的销毁：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">	<span class="keyword">import</span> <span class="title class_">LifeCycle</span> <span class="keyword">from</span> <span class="string">&#x27;./components/LifeCycle.vue&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">	<span class="keyword">import</span> &#123;ref&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">	<span class="keyword">let</span> isShown = <span class="title function_">ref</span>(<span class="literal">true</span>);</span></span><br><span class="line"><span class="language-javascript">	<span class="keyword">function</span> <span class="title function_">destroy</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">		isShown.<span class="property">value</span> = <span class="literal">false</span>;</span></span><br><span class="line"><span class="language-javascript">	&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">LifeCycle</span> <span class="attr">v-if</span>=<span class="string">&quot;isShown&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">LifeCycle</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;destroy&quot;</span>&gt;</span>销毁子组件<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在子组件 LifeCycle 中，我们分别调用所有的钩子：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> &#123;ref, onBeforeMount, onMounted, onBeforeUpdate, onUpdated, onBeforeUnmount, onUnmounted&#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> age = <span class="title function_">ref</span>(<span class="number">10</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">ageInc</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        age.<span class="property">value</span>++;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 创建</span></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;创建&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 挂载前</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">onBeforeMount</span>(<span class="function">()=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;挂载前&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 挂载后</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">onMounted</span>(<span class="function">()=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;挂载后&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 更新前</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">onBeforeUpdate</span>(<span class="function">()=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;更新前&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 更新后</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">onUpdated</span>(<span class="function">()=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;更新后&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 卸载前</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">onBeforeUnmount</span>(<span class="function">()=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;卸载前&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 卸载后</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">onUnmounted</span>(<span class="function">()=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;卸载后&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>年龄：&#123;&#123; age &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;ageInc&quot;</span>&gt;</span>年龄加一<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>最后观察到的结果：</p>
<p><img src="/img/vue3-22.gif" /></p>
<blockquote>
<p>这里补充一点：子组件和父组件都有自己的生命周期，那么到底是子组件先挂载，还是父组件先挂载？卸载的时候呢？其实可以把这一结构想象成一个栈，==挂载的时候子组件先挂载，卸载的时候父组件先卸载==。</p>
</blockquote>
<h2 id="自定义-hooks">09 自定义 hooks</h2>
<p>还记得我们在第一章的时候说过，vue3 的组合式 API
的一大优势，就是可以将不同功能模块的代码分开吗？但是貌似到目前为止，我们都没有体会到这一点，不过不用担心，这一章就是来回收第一章的伏笔的。</p>
<p>hooks，说白了，就是把相同功能的代码封装到一块去，放到一个 js 或 ts
文件里，这个文件就被称为一个 hook。</p>
<p>来看看下面这个例子：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> &#123;ref, watch&#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&quot;axios&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> count = <span class="title function_">ref</span>(<span class="number">0</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> dogList = <span class="title function_">ref</span>([<span class="string">&quot;https://images.dog.ceo/breeds/pembroke/n02113023_6570.jpg&quot;</span>]);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">countNum</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        count.<span class="property">value</span>++;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">addDog</span>(<span class="params">dog:string</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        dogList.<span class="property">value</span>.<span class="title function_">push</span>(dog);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">getDog</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        axios.<span class="title function_">get</span>(<span class="string">&quot;https://dog.ceo/api/breed/pembroke/images/random&quot;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">value</span>=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">addDog</span>(value.<span class="property">data</span>.<span class="property">message</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>计数器<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>当前：&#123;&#123; count &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;countNum&quot;</span>&gt;</span>计数器加一<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>狗狗图片<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">v-for</span>=<span class="string">&quot;dog, index in dogList&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;index&quot;</span> <span class="attr">:src</span>=<span class="string">&quot;dog&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;getDog&quot;</span>&gt;</span>获取一只狗狗<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">img</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">height</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">margin-right</span>: <span class="number">5px</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>上面展示的这个组件可以实现两个功能：点击按钮计数、获取一只狗狗的图片。效果如下：</p>
<p><img src="/img/vue3-23.gif" /></p>
<p>但是可以看到，这两个功能的代码此时是完全混在一起的，很不方便阅读，为此，我们将其封装到两个
ts 文件中。</p>
<p>在 src 目录下新建 hooks 目录，并在其下创建 useCount.ts 和 useDog.ts
(为什么要这样命名？约定俗成的，hooks 的一般命名格式就是 use*.ts)。在
useCount.ts
中，我们需要把有关计数器的代码摘出来，封装到一个函数中，并将这个函数暴露出去，不要忘记必须在函数的最后返回所有相关的数据和函数。</p>
<p>useCount.ts 的内容如下：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;ref&#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> count = <span class="title function_">ref</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">countNum</span>(<span class="params"></span>) &#123;</span><br><span class="line">        count.<span class="property">value</span>++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123;count, countNum&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>useDog.ts 的内容如下：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;ref&#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&quot;axios&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> dogList = <span class="title function_">ref</span>([<span class="string">&quot;https://images.dog.ceo/breeds/pembroke/n02113023_6570.jpg&quot;</span>]);</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">addDog</span>(<span class="params"><span class="attr">dog</span>:<span class="built_in">string</span></span>) &#123;</span><br><span class="line">        dogList.<span class="property">value</span>.<span class="title function_">push</span>(dog);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">getDog</span>(<span class="params"></span>) &#123;</span><br><span class="line">        axios.<span class="title function_">get</span>(<span class="string">&quot;https://dog.ceo/api/breed/pembroke/images/random&quot;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">value</span>=&gt;</span>&#123;</span><br><span class="line">            <span class="title function_">addDog</span>(value.<span class="property">data</span>.<span class="property">message</span>);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123;dogList, getDog&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在组件中的使用方式如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> useCount <span class="keyword">from</span> <span class="string">&quot;@/hooks/useCount&quot;</span>;  <span class="comment">// 引入hook，@表示src目录</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> useDog <span class="keyword">from</span> <span class="string">&quot;@/hooks/useDog&quot;</span>;      <span class="comment">// 引入hook，@表示src目录</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> &#123;count, countNum&#125; = <span class="title function_">useCount</span>();       <span class="comment">// 解构赋值，拿到hook中的数据和函数</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> &#123;dogList, getDog&#125; = <span class="title function_">useDog</span>();         <span class="comment">// 解构赋值，拿到hook中的数据和函数</span></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>计数器<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>当前：&#123;&#123; count &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;countNum&quot;</span>&gt;</span>计数器加一<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>狗狗图片<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">v-for</span>=<span class="string">&quot;dog, index in dogList&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;index&quot;</span> <span class="attr">:src</span>=<span class="string">&quot;dog&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;getDog&quot;</span>&gt;</span>获取一只狗狗<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">img</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">height</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">margin-right</span>: <span class="number">5px</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>很明显，用这样的方式封装好各功能模块的代码后，代码就整洁多了，也便于修改和阅读。</p>
<h2 id="路由">10 路由</h2>
<p>[TOC]</p>
<p>这一章的内容很重要！</p>
<p>路由，其实就是一种映射规则，它将一个 url
映射到一个对应的页面。当浏览器的
url，也就是导航栏的路径发生变化时，页面就会刷新。Vue
可以做到局部刷新，即当 url
改变时，不需要刷新整个页面，而只需要刷新部分需要改变的页面。</p>
<p>本章，我们将通过路由来实现下面这个效果 (请注意导航栏的变化)：</p>
<p><img src="/img/vue3-24.gif" /></p>
<h3 id="路由的基本使用">10.1 路由的基本使用</h3>
<p>要使用路由，首先要下载一个包：</p>
<figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i vue-router</span><br></pre></td></tr></table></figure>
<p>接下来将分步骤讲解路由的配置方法。</p>
<ol type="1">
<li>首先要准备好组件，页面的布局已经写好，显示主体部分要根据路由来确定，待显示的三个组件
StudentManage.vue、ClassManage.vue、SystemSetting.vue
已经准备好，等待填充。</li>
</ol>
<p><img src="/img/vue3-15.png" /></p>
<ol start="2" type="1">
<li>在 src 下新建一个文件夹 router，在 router 中创建
<code>index.ts</code>，该文件是路由器的配置文件，命名可以随意，但是写
index 会比较方便 (后面会解释原因)。<code>index.ts</code>
中应该有如下内容：</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 第一步：引入createRouter</span></span><br><span class="line"><span class="keyword">import</span> &#123;createRouter, createWebHistory&#125; <span class="keyword">from</span> <span class="string">&quot;vue-router&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 路由对应的组件要先引入</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ClassManage</span> <span class="keyword">from</span> <span class="string">&quot;@/components/ClassManage.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">StudentManage</span> <span class="keyword">from</span> <span class="string">&quot;@/components/StudentManage.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">SystemSetting</span> <span class="keyword">from</span> <span class="string">&quot;@/components/SystemSetting.vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第二步：创建路由器</span></span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">createRouter</span>(&#123;</span><br><span class="line">    <span class="attr">history</span>: <span class="title function_">createWebHistory</span>(),  <span class="comment">// 这句是什么意思之后会讲</span></span><br><span class="line">    <span class="attr">routes</span>: [  <span class="comment">// 配置路由规则，采用对象的方式，path代表一个路由，component是路由对应的组件，组件应该在上面引入</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">path</span>: <span class="string">&quot;/student&quot;</span>,</span><br><span class="line">            <span class="attr">component</span>: <span class="title class_">StudentManage</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">path</span>: <span class="string">&quot;/class&quot;</span>,</span><br><span class="line">            <span class="attr">component</span>: <span class="title class_">ClassManage</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">path</span>: <span class="string">&quot;/system&quot;</span>,</span><br><span class="line">            <span class="attr">component</span>: <span class="title class_">SystemSetting</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router;  <span class="comment">// 将定义好的路由器暴露出去</span></span><br></pre></td></tr></table></figure>
<ol start="3" type="1">
<li>注册路由器，打开 src 下的 <code>main.ts</code>，在其中引入我们在
<code>index.ts</code> 中定义的路由器 <code>router</code>
并进行注册，具体如下：</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&quot;./router&quot;</span>;  <span class="comment">// 引入router</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="title class_">App</span>);</span><br><span class="line">app.<span class="title function_">use</span>(router);  <span class="comment">// 使用router</span></span><br><span class="line">app.<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>);</span><br></pre></td></tr></table></figure>
<ol start="4" type="1">
<li>至此，我们已经定义好了路由规则，但是此时路由还无法正常访问，因为我们没有告诉
vue 组件应该放在哪里。放置路由对应的组件要使用
<code>&lt;RouterView&gt;</code>
标签，当路由切换时，系统会去找该路由对应的组件，并将该组件放到
<code>&lt;RouterView&gt;</code>
出现的位置。要注意，<code>RouterView</code> 标签是由 vue-router
提供的，所以使用前要先引入。</li>
<li>到目前为止，如果手动改变导航栏的
url，我们就已经能正常看到效果了，但是还不够，因为不可能让用户去修改导航栏来访问页面的，我们应该提供按钮，用户点击按钮之后页面自动跳转。你可能立马想到了
<code>&lt;a&gt;</code> 标签，<code>&lt;a&gt;</code>
标签当然没有问题，但是 <code>&lt;a&gt;</code>
标签会造成全局刷新，vue-router 提供了另一个标签
<code>&lt;RouterLink&gt;</code>，这个标签的本质也是
<code>&lt;a&gt;</code>
标签，但是它只会刷新局部，不会导致整个页面的刷新，该标签要跳转的路由通过
<code>to</code> 属性设置，而不是
<code>href</code>，这点请注意。同样的，要使用
<code>&lt;RouterLink&gt;</code> 也要先引入。</li>
</ol>
<p>以上就是 vue-router 的基本使用，这里还要提到
<code>&lt;RouterLink&gt;</code> 上的一个属性
<code>active-class</code>，我们经常会遇到当某个链接被按下时，对应的按钮要改变样式以突出，我们一般的做法就是在被点击的按钮上加一个
class，而 <code>active-class</code>
这个属性非常方便，它用于设置当某个路由被激活时，对应的
<code>&lt;RouterLink&gt;</code> 上的
class。注意，这里说的是当某个路由被激活时，而不是当元素被点击时，这意味着绑定了当前路由的所有
<code>&lt;RouterLink&gt;</code> 都会处于 active
状态，于是都被添加上同样的 class。</p>
<h3 id="开发标准">10.2 开发标准</h3>
<p>这一节主要讲上面没提到的两个注意事项：</p>
<ol type="1">
<li>在一般工程的开发标准中，我们需要把一般组件和路由组件区分开来，一般组件放在
components 目录下，而路由组件则放在 pages 或 views 目录下。</li>
<li>路由切换时，上一个路由组件其实是被卸载掉了，需要的时候会再次挂载。</li>
</ol>
<h3 id="路由器的工作模式">10.3 路由器的工作模式</h3>
<p>路由器的工作模式有 history 和 hash 两种模式，这两种模式的显式区别在于
url，当使用 history 模式时，导航栏的 url 中会出现一个井号 <code>#</code>
，而 hash 模式不会，至于具体的区别这里就不讲了，涉及到服务端的知识。</p>
<ol type="1">
<li><p><code>history</code> 模式</p>
<p>优点：<code>URL</code> 更加美观，不带有
<code>#</code>，更接近传统的网站 <code>URL</code>。</p>
<p>缺点：后期项目上线，需要服务端配合处理路径问题，否则刷新会有
<code>404</code> 错误。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> router = <span class="title function_">createRouter</span>(&#123;</span><br><span class="line"> 	<span class="attr">history</span>:<span class="title function_">createWebHistory</span>(), <span class="comment">// history模式，需要事先引入该函数</span></span><br><span class="line">	<span class="comment">/******/</span></span><br><span class="line"> &#125;)</span><br></pre></td></tr></table></figure></li>
<li><p><code>hash</code> 模式</p>
<p>优点：兼容性更好，因为不需要服务器端处理路径。</p>
<p>缺点：<code>URL</code> 带有 <code>#</code> 不太美观，且在
<code>SEO</code> 优化方面相对较差。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> router = <span class="title function_">createRouter</span>(&#123;</span><br><span class="line">	<span class="attr">history</span>:<span class="title function_">createWebHashHistory</span>(), <span class="comment">// hash模式，需要事先引入该函数</span></span><br><span class="line"> 	<span class="comment">/******/</span></span><br><span class="line"> &#125;)</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="to-的第二种写法">10.4 to 的第二种写法</h3>
<p>在 10.1 中，我们介绍了 <code>&lt;RouterLink&gt;</code> 标签中
<code>to</code> 属性的一种写法，直接写路由：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">RouterLink</span> <span class="attr">to</span>=<span class="string">&quot;/student&quot;</span> <span class="attr">active-class</span>=<span class="string">&quot;routeActive&quot;</span>&gt;</span>链接<span class="tag">&lt;/<span class="name">RouterLink</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这里还有第二种写法，可以写一个对象，既然要写对象，那么就必须先在 to
前面加一个<strong>冒号</strong>，否则我们写的只会是一个字符串。该对象中应该有一个属性
<code>path</code>，这个属性的值就是路由
(字符串)，所以上面的代码可以改写成下面的样子：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">RouterLink</span> <span class="attr">:to</span>=<span class="string">&quot;&#123;path: &#x27;/path&#x27;&#125;&quot;</span> <span class="attr">active-class</span>=<span class="string">&quot;routeActive&quot;</span>&gt;</span>链接<span class="tag">&lt;/<span class="name">RouterLink</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>现在还看不出来这种写法的优势，但后面我们就能体会到了。</p>
<h3 id="路由命名">10.5 路由命名</h3>
<p>通过 <code>name</code>
属性，我们可以给路由起一个名字，然后通过路由的名字来直接访问路由。打开
<code>router/index.ts</code>，通过下面这种方式为 <code>/student</code>
路由起一个名字 <code>xs</code>：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> router = <span class="title function_">createRouter</span>(&#123;</span><br><span class="line">    <span class="attr">history</span>: <span class="title function_">createWebHistory</span>(),</span><br><span class="line">    <span class="attr">routes</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&quot;xs&quot;</span>,</span><br><span class="line">            <span class="attr">path</span>: <span class="string">&quot;/student&quot;</span>,</span><br><span class="line">            <span class="attr">component</span>: <span class="title class_">StudentManage</span></span><br><span class="line">        &#125;,</span><br><span class="line">        ···</span><br><span class="line">    ]</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>随后，在 <code>&lt;RouterLink&gt;</code>
中，我们就可以这样配置要跳转的路由：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">RouterLink</span> <span class="attr">:to</span>=<span class="string">&quot;&#123;name: &#x27;xs&#x27;&#125;&quot;</span> <span class="attr">active-class</span>=<span class="string">&quot;routeActive&quot;</span>&gt;</span>链接<span class="tag">&lt;/<span class="name">RouterLink</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>那么为什么要使用
<code>name</code>？在学习了路由传参和嵌套路由之后，你就会发现路由可能会非常长，写起来很麻烦，这种时候就能凸显出
<code>name</code> 的作用了。</p>
<h3 id="嵌套路由">10.6 嵌套路由</h3>
<p>接下来，我们要实现这样的效果：</p>
<p><img src="/img/vue3-25.gif" /></p>
<p>要实现上面的效果，我们需要学习嵌套路由和路由传参的知识。首先来认识一下嵌套路由，嵌套路由就是子级路由，从上图中我们可以看到，原本的路由处于
<code>/student</code> 下，点击链接后，路由变成了
<code>/student/detail</code>
(问号后面的参数我们暂时不理会)，这就是嵌套路由，一个路由在另一个路由之下。通过分析页面关系我们也能看出来，一开始我们已经处于学生管理界面了，但是通过点击链接，在该页面下又出现了新页面。</p>
<p>由上可见，<code>/detail</code> 是 <code>/student</code>
的子级路由，子级路由的配置方式是：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> router = <span class="title function_">createRouter</span>(&#123;</span><br><span class="line">    <span class="attr">history</span>: <span class="title function_">createWebHistory</span>(),</span><br><span class="line">    <span class="attr">routes</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&quot;xs&quot;</span>,</span><br><span class="line">            <span class="attr">path</span>: <span class="string">&quot;/student&quot;</span>,</span><br><span class="line">            <span class="attr">component</span>: <span class="title class_">StudentManage</span>,</span><br><span class="line">            <span class="attr">children</span>: [  <span class="comment">// 子级路由</span></span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">name</span>: <span class="string">&#x27;xijie&#x27;</span>,</span><br><span class="line">                    <span class="attr">path</span>: <span class="string">&#x27;detail&#x27;</span>,</span><br><span class="line">                    <span class="attr">component</span>: <span class="title class_">Detail</span></span><br><span class="line">                &#125;,</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        ···</span><br><span class="line">    ]</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>注意事项：子级路由的 <code>path</code> 不需要加斜杠！</p>
<p>对应的 <code>&lt;RouterLink&gt;</code> 应该这样写：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">RouterLink</span> <span class="attr">to</span>=<span class="string">&quot;/student/detail&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">RouterLink</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这种时候你就能想到了，如果层级很多，那么路由可能就会非常长，这种情况下给路由起一个名字来直接跳转是最方便的。</p>
<h3 id="路由传参">10.7 路由传参</h3>
<p>要想实现 10.6
的效果，光靠嵌套路由是不够的。当我们要查看具体某个学生的信息时，父级路由应该告诉子级路由，我们要查看的学生是哪一位，这就要涉及到路由的传参。路由的参数有两种
—— query 和 params。</p>
<h4 id="query-参数">10.7.1 query 参数</h4>
<p>最简单的传参方式：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">RouterLink</span> <span class="attr">to</span>=<span class="string">&quot;/student/detail?参数1=值1&amp;参数2=值2&amp;参数3=值3&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">RouterLink</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>参数是传给子级路由的，所以到子级路由的视图 (view)
中去接收。接收路由参数需要引入一个 hook：<code>useRoute</code>。这个
hook 返回一个对象：</p>
<p><img src="/img/vue3-16.png" /></p>
<p>这个对象上有诸多属性，其中有一个属性叫
<code>query</code>，其值也是一个对象，这个 <code>query</code>
是我们需要关注的，它的身上携带着路由的参数。例如上图中，我们就传来了一个
cname 参数，其值为“李小狼”。</p>
<p>上面展示的是最普通的传参方式，别忘记还有一种对象写法：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">RouterLink</span> <span class="attr">:to</span>=<span class="string">&quot;&#123;</span></span></span><br><span class="line"><span class="string"><span class="tag">    path: &#x27;/student/detail&#x27;,</span></span></span><br><span class="line"><span class="string"><span class="tag">    query: &#123;</span></span></span><br><span class="line"><span class="string"><span class="tag">        参数1: 值1,</span></span></span><br><span class="line"><span class="string"><span class="tag">        参数2: 值2,</span></span></span><br><span class="line"><span class="string"><span class="tag">        参数3: 值3</span></span></span><br><span class="line"><span class="string"><span class="tag">    &#125;</span></span></span><br><span class="line"><span class="string"><span class="tag">&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">RouterLink</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>上面这种写法的好处在于，字符串被当作表达式来进行解析，有语法高亮，而且拼串的问题会更好解决。</p>
<blockquote>
<p>这里要注意一件事情：当只有路由参数变化时，路由是发生了改变，但是这并不会引起原本的组件被卸载，只会导致原本的组件被更新，<code>setup</code>
中的代码是不会被重新运行的，可以使用 <code>onBeforeUpdate</code>
在组件更新时做一些操作。</p>
<p>另外，如果打算解构赋值获取 <code>useRoute</code> 返回的对象上的
<code>query</code> 属性，然后在模板中直接使用，那么需要给
<code>useRoute()</code> 套一层
<code>toRefs</code>，否则会失去响应式。</p>
</blockquote>
<h4 id="params-参数">10.7.2 params 参数</h4>
<p>params 参数写起来比 query 参数要简洁，query
参数需要以键值对的方式进行书写，而 params 直接写值就行：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">RouterLink</span> <span class="attr">to</span>=<span class="string">&quot;/student/detail/参数值1/参数值2/参数值3&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">RouterLink</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>虽然话是这么说，但参数不能没有名字，不然我们怎么去获取参数呢。params
中的参数并非没有名字，而是事先已经约定好了，每个位置上的参数值有对应的固定的名字，因此传参的时候可以省略而已。要配置
params 参数的名字，需要到 index.ts 中做以下修改：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> router = <span class="title function_">createRouter</span>(&#123;</span><br><span class="line">    <span class="attr">history</span>: <span class="title function_">createWebHistory</span>(),</span><br><span class="line">    <span class="attr">routes</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&quot;xs&quot;</span>,</span><br><span class="line">            <span class="attr">path</span>: <span class="string">&quot;/student&quot;</span>,</span><br><span class="line">            <span class="attr">component</span>: <span class="title class_">StudentManage</span>,</span><br><span class="line">            <span class="attr">children</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">name</span>: <span class="string">&#x27;xijie&#x27;</span>,</span><br><span class="line">                    <span class="attr">path</span>: <span class="string">&#x27;detail/:参数名1/:参数名2/:参数名3&#x27;</span>,  <span class="comment">// 看这里！</span></span><br><span class="line">                    <span class="attr">component</span>: <span class="title class_">Detail</span></span><br><span class="line">                &#125;,</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        ···</span><br><span class="line">    ]</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>如上我们就可以正常传参了，获取参数仍然使用
<code>useRoute</code>，但是不同的是，这一次我们不再是从
<code>query</code> 对象上获取参数，而是从 <code>params</code>
对象属性上获取参数，除此以外没有什么区别，故不再赘诉。</p>
<p>和 query 参数一样，params 参数也有对象写法，两者稍有区别：</p>
<ol type="1">
<li>params 参数传参时不能使用 <code>path</code>，而必须要使用
<code>name</code>，所以必须给路由起名。</li>
<li>要把属性名从 <code>query</code> 改成 <code>params</code>。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">RouterLink</span> <span class="attr">:to</span>=<span class="string">&quot;&#123;</span></span></span><br><span class="line"><span class="string"><span class="tag">    name: &#x27;xijie&#x27;,</span></span></span><br><span class="line"><span class="string"><span class="tag">    params: &#123;</span></span></span><br><span class="line"><span class="string"><span class="tag">        参数1: 值1,</span></span></span><br><span class="line"><span class="string"><span class="tag">        参数2: 值2,</span></span></span><br><span class="line"><span class="string"><span class="tag">        参数3: 值3</span></span></span><br><span class="line"><span class="string"><span class="tag">    &#125;</span></span></span><br><span class="line"><span class="string"><span class="tag">&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">RouterLink</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>几个注意事项：</p>
<ol type="1">
<li>按照上面的方法设置的 params
参数是必填参数，意思是在路由中配置了某一参数之后就必须传递该参数，否则会报错，如果要将某参数设置为可选参数，可在参数名后面加一问号：<code>'detail/:参数名1/:参数名2/:参数名3?'</code>，如此以来，就算不传参数
3 也不会报错。</li>
<li>参数值不接受数组等对象类型数据。</li>
</ol>
</blockquote>
<h3 id="路由的-props-配置">10.8 路由的 props 配置</h3>
<p>这里要特别强调一下是路由的 props 配置，而不是组件的 props
配置。按照上面讲的，当我们要获取路由参数时，我们都需要从一个
hook，也就是 <code>useRoute</code>
上获取一个对象，然后再去找这个对象上的 <code>query</code> 或
<code>params</code>
属性，这两个属性又是一个对象，它们上携带着真正的路由参数，如此一来，当我们需要在模板中使用路由参数时需要使用
<code>route.query.xxx</code> 或者
<code>route.params.xxx</code>，非常麻烦。</p>
<p>路由的 props 配置项提供了一个解决方案，当路由的 props
开启时，所有的路由参数会像组件间通信一样，传给子组件，随后在子组件中通过
<code>defineProps</code> 函数就能接收全部参数，无需使用
<code>useRoute</code> 就能直接使用所有参数。</p>
<p>第一种开启 props 的方法：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> router = <span class="title function_">createRouter</span>(&#123;</span><br><span class="line">    <span class="attr">history</span>: <span class="title function_">createWebHistory</span>(),</span><br><span class="line">    <span class="attr">routes</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&quot;xs&quot;</span>,</span><br><span class="line">            <span class="attr">path</span>: <span class="string">&quot;/student&quot;</span>,</span><br><span class="line">            <span class="attr">component</span>: <span class="title class_">StudentManage</span>,</span><br><span class="line">            <span class="attr">children</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">name</span>: <span class="string">&#x27;xijie&#x27;</span>,</span><br><span class="line">                    <span class="attr">path</span>: <span class="string">&#x27;detail/:name/:age/:sex&#x27;</span>,</span><br><span class="line">                    <span class="attr">component</span>: <span class="title class_">Detail</span>,</span><br><span class="line">                    <span class="attr">props</span>: <span class="literal">true</span>   <span class="comment">// 看这里</span></span><br><span class="line">                &#125;,</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        ···</span><br><span class="line">    ]</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>然后在子组件中用 <code>defineProps</code> 接收：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&#x27;ts&#x27;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> &#123;defineProps&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">definePros</span>([<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;age&#x27;</span>, <span class="string">&#x27;sex&#x27;</span>]);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>随后，便可在模板中直接使用接收到的三个参数了。</p>
<p>==但是注意：上面这种设置 props 的方法只适用于 <code>params</code>
参数，对 <code>query</code> 参数是无效的。==不过，props
还有第二种写法以解决这一问题。第二种写法要求将 props
写成一个函数，该函数接收一个参数，该参数就是我们之前通过
<code>useRoute</code> 获取的 <code>route</code>
对象。函数的返回值也为一个对象，将所有我们需要的参数封装到这个对象上，我们就能正常的在子组件中使用
<code>defineProps</code>
来接收了。函数的返回值是一个对象，<code>route</code>
也是一个对象，所以我们可以直接返回 <code>route</code> 上的
<code>params</code> 或 <code>query</code> 即可：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> router = <span class="title function_">createRouter</span>(&#123;</span><br><span class="line">    <span class="attr">history</span>: <span class="title function_">createWebHistory</span>(),</span><br><span class="line">    <span class="attr">routes</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&quot;xs&quot;</span>,</span><br><span class="line">            <span class="attr">path</span>: <span class="string">&quot;/student&quot;</span>,</span><br><span class="line">            <span class="attr">component</span>: <span class="title class_">StudentManage</span>,</span><br><span class="line">            <span class="attr">children</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">name</span>: <span class="string">&#x27;xijie&#x27;</span>,</span><br><span class="line">                    <span class="attr">path</span>: <span class="string">&#x27;detail/:name/:age/:sex&#x27;</span>,</span><br><span class="line">                    <span class="attr">component</span>: <span class="title class_">Detail</span>,</span><br><span class="line">                    <span class="title function_">props</span> (route) &#123;</span><br><span class="line">                        <span class="keyword">return</span> route.<span class="property">query</span>;	<span class="comment">// 如果是params就return route.params；但如果真是params，其实用props:true一行解决就行了</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        ···</span><br><span class="line">    ]</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>其实这里还有第三种写法，那就是直接把 props
的属性值写成一个对象，不过这种写法只能写死，没有意义，常用的还是上面两种，故不赘述。</p>
<blockquote>
<p>疑问：这样使用的话，路由参数和组件间参数不就混在一起了吗？但其实并没有混在一起，路由组件不是一般组件，出现在模板中的组件不是组件本身而是
<code>&lt;RouterView&gt;</code>，父级组件根本没有机会通过 props
配置项直接给路由组件传参，只能通过路由传参，因此不存在路由参数和组件参数混淆的情况。</p>
</blockquote>
<h3 id="replace-属性">10.9 replace 属性</h3>
<p>路由跳转有两种模式，一种是 push，一种是 replace。所谓
push，就是像堆栈一样，每进行一次跳转，就把新路由入栈，之前访问过的路由将会作为历史记录保存，浏览器仍然可以通过后退来进行访问。而
replace 就不一样，路由每次跳转时，如果采用 replace
模式，新路由将会直接替换掉栈顶的路由，导致上一次访问的路由直接消失，因此浏览器无法通过后退来回到上一次的路由。</p>
<p>Vue 默认采用的路由跳转模式是 push，这样浏览器将可以后退。如果想设置为
replace，只需要在 <code>&lt;RouterLink&gt;</code> 上加一个属性
<code>replace</code> 就行了：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">RouterLink</span> <span class="attr">to</span>=<span class="string">&quot;/xxx&quot;</span> <span class="attr">replace</span>&gt;</span><span class="tag">&lt;/<span class="name">RouterLink</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这样以来，当该 <code>&lt;RouterLink&gt;</code>
被点击时，浏览器将会用该标签的 <code>to</code>
属性中的路由直接替换原本的路由，浏览器无法后退至上一次访问过的路由。</p>
<h3 id="编程式路由导航">10.10 编程式路由导航</h3>
<p>讲了这么多，前面我们都是通过 <code>&lt;RouterLink&gt;</code>
来进行路由跳转，这个标签的本质其实是一个 <code>&lt;a&gt;</code>
标签，vue 编译完后还是使用 <code>&lt;a&gt;</code>
标签进行的跳转，这就有一个问题：难道我们只能通过 <code>&lt;a&gt;</code>
标签进行跳转吗？如果我有需求，要使用 <code>&lt;button&gt;</code>
或其他标签进行路由跳转呢？这就要引出编程式路由导航了。</p>
<p>所谓编程式，其实就是指在 <code>&lt;script&gt;</code> 标签中通过 js 或
ts 代码来进行路由跳转。要实现这一点，就要从 vue-router
中引入一个工具：<code>useRouter</code> (注意与前面学的
<code>useRoute</code> 区分开)。<code>useRouter</code> 也是一个
hook，它会返回一个对象 ——
router，这就是管理整个路由导航的路由器，使用它可以轻松实现路由跳转。</p>
<p>router 上有两个重要的函数：<code>replace</code> 和
<code>push</code>，这两个函数的作用不用多说，上一节已经讲过了。重要的是如何使用，其实它们的使用方法和
<code>&lt;RouterLink&gt;</code> 中 <code>to</code>
属性的使用方法是一模一样的，<code>to</code>
属性中可以写什么，它们的参数就可以写什么，所以，它们的参数既可以写字符串，也可以写对象，当要用编程式路由导航替换
<code>&lt;RouterLink&gt;</code> 的时候，直接把它的 <code>to</code>
属性的内容原封不动地拿过来就行了。</p>
<h3 id="重定向">10.11 重定向</h3>
<p>这一节我们来处理一个被我们一直忽视的问题，打开我们的网页，什么都不要做，打开开发者工具，进入控制台，能看到这样一个报错：</p>
<p><img src="/img/vue3-17.png" /></p>
<p>这个报错是由于，一上来，我们没有选中任何一个路由，我们的路由位于
<code>/</code>，但是在 <code>index.ts</code> 中我们又没有配置
<code>/</code> 路由，所以 vue 返回不了对应的页面。</p>
<p>我们希望的是，当网页被打开时，帮我们跳转到一个默认的路由上去，这一过程就叫做<strong>重定向</strong>。要实现重定向很简单，我们只需要在
<code>index.ts</code> 中加上这么一个路由：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;/&quot;</span>,</span><br><span class="line">    <span class="attr">redirect</span>: <span class="string">&quot;/student&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>之后，当我们打开页面时，如果页面的路由为
<code>/</code>，页面就会自动跳转到 <code>/student</code> 路由下。</p>
<h2 id="pinia">11 Pinia</h2>
<h3 id="安装-pinia">11.1 安装 Pinia</h3>
<p>Pinia 是 vue3 中的集中式状态管理工具 (在 vue2 中我们使用的是
vuex，状态可以理解为数据)，它的作用是管理组件间的数据共享。有些数据应该是公共的，例如对于一个商城来讲，用户的头像等信息，可能在不同的组件中都要展示，那么显然，每个组件都拥有一个用户头像是不太合适的，因此头像应该作为共享数据，供有需要的组件使用。但同时，还有一部分信息，例如与组件自身功能有关的信息，就应该由组件自己持有。</p>
<p>要想使用 pinia，要先安装 pinia：</p>
<figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i pinia</span><br></pre></td></tr></table></figure>
<p>安装完后引入 pinia，在 main.ts 中写入：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createPinia &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> pinia = <span class="title function_">createPinia</span>();</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="title class_">App</span>);</span><br><span class="line">app.<span class="title function_">use</span>(pinia);</span><br><span class="line">app.<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>);</span><br></pre></td></tr></table></figure>
<h3 id="存储和读取数据">11.2 存储和读取数据</h3>
<p>Pinia 的使用方法类似于之前学过的 hooks，都是由一个 ts
文件向外暴露一个函数，该函数返回一个对象，对象中封装的，就是实现某一功能所要用到的全部数据，这也再一次体现了组合式
API 的思想。</p>
<p>根据规范，我们要在 src 目录下新建一个目录 stores，所有状态管理相关的
ts 文件都放在该目录下。ts 文件的文件名应该尽量体现其功能，以下是这些 ts
文件的大致写法：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&quot;pinia&quot;</span>;   <span class="comment">// 引入defineStore</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 命名规范：useXxxStore</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useNumberStore = <span class="title function_">defineStore</span>(</span><br><span class="line">	<span class="string">&quot;number&quot;</span>,  <span class="comment">// store的id值，最好和文件名保持一致</span></span><br><span class="line">	&#123;</span><br><span class="line">    <span class="title function_">state</span>(<span class="params"></span>) &#123;  <span class="comment">// state函数</span></span><br><span class="line">        <span class="keyword">return</span> &#123;  <span class="comment">// 返回一个封装了相关状态(数据)的对象</span></span><br><span class="line">            <span class="attr">num</span>: <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>上示代码中， <code>defineStore</code> 用来创建一个 store，如果你熟悉
vue2 的话就应该知道，store
是仓库的意思，可理解为数据的仓库。<code>defineStore</code>
接收两个参数：store 的 id 值和一个对象。id
值最好和文件名保持一致，而第二个参数则要给出一个包含了
<code>state</code> 函数的对象，该函数返回一个封装了所需状态 (数据)
的对象。上述代码中，我们创建了一个名为 <code>useNumberStore</code>
的函数并暴露了出去，它可以返回一个 store，该 store 的 id 是
<code>number</code>，其中携带了一个数据 <code>num</code>，其初始值为
1。</p>
<p>以上是存储数据的方法，接下来演示如何读取数据。在对应的组件中，我们通过引入上面暴露的函数来获取该
store：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useNumberStore &#125; <span class="keyword">from</span> <span class="string">&quot;@/stores/number&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> numberStore = <span class="title function_">useNumberStore</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(numberStore)</span><br></pre></td></tr></table></figure>
<p>打印一下获取到的 store 对象，我们可以得到如下结果：</p>
<p><img src="/img/vue3-18.png" /></p>
<p>可以看到，store 上有一个名为 <code>num</code> 的 Ref
对象，那么这是否意味着我们可以使用 <code>numberStore.num.value</code>
的方式来读取数据？并不是，我们只需要写 <code>numberStore.value</code>
就行了，你可能会问为什么，这是一个比较 tricky
的点，我们稍微解释一下，看下面这段代码：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="title function_">ref</span>(<span class="number">1</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a.<span class="property">value</span>);   <span class="comment">// 正常</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> b = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">    <span class="attr">x</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">y</span>: <span class="title function_">ref</span>(<span class="number">2</span>)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(b.<span class="property">x</span>);        <span class="comment">// 正常</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(b.<span class="property">y</span>);        <span class="comment">// 正常</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(b.<span class="property">y</span>.<span class="property">value</span>);  <span class="comment">// 报错</span></span><br></pre></td></tr></table></figure>
<p>上示代码中，<code>a</code> 是 ref 对象，所以需要 <code>.value</code>
来访问其值；而 <code>b</code> 是一个 <code>reactive</code>
对象，其中，<code>y</code> 是 <code>b</code> 上一个 ref
对象属性，虽然也是 ref 对象，但是不需要 <code>b.y.value</code>
就可以直接访问其值，加了 <code>.value</code> 反而是错的，这是因为当一个
<code>reactive</code> 对象中有 ref
对象属性时，它会自动帮你解包，不需要手动加
<code>.value</code>，这是一个要注意的小点。</p>
<h3 id="三种修改数据的方式">11.3 三种修改数据的方式</h3>
<h4 id="直接修改">11.3.1 直接修改</h4>
<p>上一节介绍了存储和读取数据的方法，这一节介绍一下修改数据的方法。最简单的一种方法就是直接修改，例如：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123; useNumberStore &#125; <span class="keyword">from</span> <span class="string">&quot;@/stores/selectNum&quot;</span>;</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">const</span> numberStore = <span class="title function_">useNumberStore</span>();</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">function</span> <span class="title function_">IncNum</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">	numberStore.<span class="property">num</span>++;    <span class="comment">// 直接修改num</span></span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">function</span> <span class="title function_">DecNum</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">	numberStore.<span class="property">num</span>--;    <span class="comment">// 直接修改num</span></span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">span</span>&gt;</span>学号：<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123; numberStore.num &#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;incBtn&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;IncNum&quot;</span>&gt;</span>+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;decBtn&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;DecNum&quot;</span>&gt;</span>-<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这种直接修改数据的方式只有 vue3 支持，在 vue2 中，vuex
不支持直接修改。</p>
<h4 id="patch">11.3.2 $patch</h4>
<p>第二种修改数据的方法是调用 store 上的 <code>$patch</code>
函数，该接收一个对象，可以一次性修改多个数据的值。假设我们有一个
store，其中有 sex、age、name 等属性，我们使用 <code>$patch</code>
直接修改其值：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useStudentInfoStore &#125; <span class="keyword">from</span> <span class="string">&quot;@/stores/studentInfo&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> studentInfoStore = <span class="title function_">useStudentInfoStore</span>();</span><br><span class="line">studentInfoStore.$patch(&#123;</span><br><span class="line">	<span class="attr">sex</span>: <span class="string">&#x27;男&#x27;</span>,</span><br><span class="line">	<span class="attr">age</span>: <span class="number">20</span>,</span><br><span class="line">	<span class="attr">name</span>: <span class="string">&#x27;unknown&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><code>$patch</code>
相当于是直接赋值，一次性替换掉原数据，当你需要一次性修改很多数据时，推荐使用这种方法。</p>
<h4 id="actions">11.3.3 actions</h4>
<p><code>actions</code>
是一个配置项，可以定义“动作”，所谓“动作”其实就是一系列事先定义好的函数，调用这些函数来实现一些数据的修改行为，由于是事先写好的，所以具有更高的安全性和封装性。例：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&quot;pinia&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useNumberStore = <span class="title function_">defineStore</span>(<span class="string">&quot;number&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">actions</span>: &#123;</span><br><span class="line">        <span class="title function_">increment</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">num</span> += <span class="number">2</span>;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="title function_">decrement</span>(<span class="params"></span>) &#123;</span><br><span class="line">	        <span class="variable language_">this</span>.<span class="property">num</span> -= <span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">state</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">num</span>: <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>在上面，我们定义了名为 <code>increment</code> 和
<code>decrement</code> 的 action，当调用这两个函数时，数据
<code>num</code> 将会加 2 或减 2。下面是调用该动作的方法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; ref, reactive &#125; from &quot;vue&quot;;</span><br><span class="line">import &#123; useNumberStore &#125; from &quot;@/stores/selectNum&quot;;</span><br><span class="line">import &#123; useStudentInfoStore &#125; from &quot;@/stores/studentInfo&quot;;</span><br><span class="line">const numberStore = useNumberStore();</span><br><span class="line">const studentStore = useStudentInfoStore();</span><br><span class="line">function IncNum() &#123;</span><br><span class="line">	numberStore.increment();</span><br><span class="line">&#125;</span><br><span class="line">function DecNum() &#123;</span><br><span class="line">	numberStore.decrement();</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div class=&quot;container&quot;&gt;</span><br><span class="line">		&lt;span&gt;学号：&lt;/span&gt;</span><br><span class="line">		&lt;h1&gt;&#123;&#123; numberStore.num &#125;&#125;&lt;/h1&gt;</span><br><span class="line">		&lt;button id=&quot;incBtn&quot; @click=&quot;IncNum&quot;&gt;+&lt;/button&gt;</span><br><span class="line">		&lt;button id=&quot;decBtn&quot; @click=&quot;DecNum&quot;&gt;-&lt;/button&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<h3 id="storetorefs">11.4 storeToRefs</h3>
<p>当我们需要访问 store 上的数据时，我们需要采用 <code>store.xxx</code>
的形式去访问，如果觉得这么写太麻烦，我们自然而然就会想到解构赋值，去直接获取数据：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> &#123;xxx, yyy, zzz&#125; = store;</span><br></pre></td></tr></table></figure>
<p>但是就像之前老生常谈的，这样做会使数据失去响应式，所以我们自然而然又想到使用
<code>toRefs</code>：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> &#123;xxx, yyy, zzz&#125; = <span class="title function_">toRefs</span>(store);</span><br></pre></td></tr></table></figure>
<p>那么这样做是否可行呢？答案是可行的，但是这样做不好，如果你在控制台输出一下
<code>toRefs(store)</code> 的话，就会发现控制台打印如下内容：</p>
<p><img src="/img/vue3-19.png" /></p>
<p>你可以发现，<code>toRefs</code> 函数将 store
对象上的每一个属性都变成了 ref
对象，就连函数都包括在内，这显然是不妥的。vue
的开发者自然也想到了这个问题，所以官方提供了另一个函数
<code>storeToRefs</code> 来解决，这个函数只会将 store 上的数据变成 ref
对象，所以数据被解构赋值之后不会丢失响应式，打印
<code>storeToRefs(store)</code> 后控制台的内容为：</p>
<p><img src="/img/vue3-20.png" /></p>
<p>这样一来，只有数据会被转换成 ref
对象。一个小注意点：<code>storeToRefs</code> 函数由 pinia
组件提供，不要从 vue 中引入。</p>
<h3 id="getters">11.5 getters</h3>
<p>getters 用于创建经过加工后的数据，相当于是 pinia 中的计算属性。例如在
state 中已有数据 num，而我们还需要一个数据 absNum，其值为 num
的绝对值，那么我们可以在 getters 中追加一个属性：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&quot;pinia&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useNumberStore = <span class="title function_">defineStore</span>(<span class="string">&quot;number&quot;</span>, &#123;</span><br><span class="line">    <span class="title function_">state</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">num</span>: <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">getters</span>: &#123;</span><br><span class="line">	    <span class="title function_">absNum</span>(<span class="params">state</span>) &#123;</span><br><span class="line">		    <span class="keyword">return</span> <span class="title class_">Math</span>.<span class="title function_">abs</span>(state.<span class="property">num</span>);</span><br><span class="line">	    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>getters 中的属性都是函数，函数接收一个参数
<code>state</code>，通过它我们可以获取我们在 pinia
中配置的数据。当然，除了直接使用 <code>state</code>，我们还可以使用
<code>this</code>，效果是一样的：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">getters</span>: &#123;</span><br><span class="line">	<span class="title function_">absNum</span>(<span class="params"></span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="title class_">Math</span>.<span class="title function_">abs</span>(<span class="variable language_">this</span>.<span class="property">num</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但如果不打算使用 <code>this</code>，那么就可以直接写成箭头函数：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">getters</span>: &#123;</span><br><span class="line">	<span class="attr">absNum</span>: <span class="function"><span class="params">state</span>=&gt;</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="title class_">Math</span>.<span class="title function_">abs</span>(state.<span class="property">num</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="subscribe">11.6 $subscribe</h3>
<p><code>$subscribe</code> 函数是 store 对象上的一个函数，它可以监视
store 的变化。当 store 中的数据发生变化，<code>$subscribe</code>
中传入的回调函数就会被调用，例如：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useNumberStore &#125; <span class="keyword">from</span> <span class="string">&quot;@/stores/selectNum&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> numberStore = <span class="title function_">useNumberStore</span>();</span><br><span class="line">numberStore.$subscribe(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;数据被修改了&#x27;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><code>$subscribe</code> 中可以接收两个参数，一个是
<code>mutate</code>，这是一个对象，记录了数据的变化，一般我们不关注；还有一个参数是
<code>state</code>，这个就是 store 中当前保存的数据。</p>
<h3 id="store-组合式写法">11.7 store 组合式写法</h3>
<p>上面介绍的是选项式写法，即将动作都放在 actions 里，把数据放在 state
里，把计算属性放在 getters 里，但其实，<code>defineStore</code>
可以直接接收一个函数，然后我们把要写的 actions、state、getters
都作为这个函数的返回值写在函数里。</p>
<p>接下来展示一个例子，假设原本我们有选项式写法：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&quot;pinia&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useNumberStore = <span class="title function_">defineStore</span>(<span class="string">&quot;number&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">actions</span>: &#123;</span><br><span class="line">        <span class="title function_">increment</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">num</span> += <span class="number">2</span>;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="title function_">decrement</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">num</span> -= <span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">state</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">num</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&quot;wxm&quot;</span>,</span><br><span class="line">            <span class="attr">age</span>: <span class="number">19</span>,</span><br><span class="line">            <span class="attr">sex</span>: <span class="string">&quot;male&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">getters</span>: &#123;</span><br><span class="line">        <span class="attr">absNum</span>: <span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title class_">Math</span>.<span class="title function_">abs</span>(state.<span class="property">num</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>将上示代码改写成组合式写法就是：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&quot;pinia&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ref, computed &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useNumberStore = <span class="title function_">defineStore</span>(<span class="string">&quot;number&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">	<span class="comment">// state</span></span><br><span class="line">	<span class="keyword">let</span> num = <span class="title function_">ref</span>(<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">let</span> name = <span class="title function_">ref</span>(<span class="string">&quot;wxm&quot;</span>);</span><br><span class="line">	<span class="keyword">let</span> age = <span class="title function_">ref</span>(<span class="number">19</span>);</span><br><span class="line">	<span class="keyword">let</span> sex = <span class="title function_">ref</span>(<span class="string">&quot;male&quot;</span>);</span><br><span class="line">	<span class="comment">// actions</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">increment</span>(<span class="params"></span>) &#123;</span><br><span class="line">        num.<span class="property">value</span> += <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">decrement</span>(<span class="params"></span>) &#123;</span><br><span class="line">        num.<span class="property">value</span> -= <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// getters</span></span><br><span class="line">    <span class="keyword">let</span> absNum = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> <span class="title class_">Math</span>.<span class="title function_">abs</span>(num.<span class="property">value</span>));</span><br><span class="line">    <span class="keyword">return</span> &#123; num, name, age, sex, increment, decrement, absNum &#125;;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="组件通信">12 组件通信</h2>
<h3 id="props-1">12.1 props</h3>
<p>props 的用法其实在 <a href="07%20props.md">07 props</a>
已经说过了，它可以实现父组件到子组件的通信，但是它不适合用于子组件给父组件通信。如果想要使用
props
来给父组件发信息，可以这样做：父组件先给子组件一个函数，子组件调用该函数，由于函数是属于父组件的，所以该函数将能影响到父组件的数据，以此可以实现子组件到父组件的通信。例如在子组件中，我们定义了一个对象
<code>studInfo</code>，该对象封装了一个学生的信息，父组件则负责展示学生的信息，因此子组件应该向父组件发送该对象。使用
props 完成这一任务的方法：</p>
<ol type="1">
<li>在父组件中定义函数 <code>getStudInfo</code>，并将该函数通过 props
传给子组件：</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;script lang=&quot;ts&quot; setup&gt;</span><br><span class="line">import Son from &quot;@/components/communication/Son.vue&quot;;</span><br><span class="line">import &#123; reactive &#125; from &quot;vue&quot;;</span><br><span class="line">let stud = reactive(&#123;  // 事先定义好对象，准备接收数据</span><br><span class="line">    name: &quot;&quot;,</span><br><span class="line">    imageLink: &quot;&quot;,</span><br><span class="line">    intro: &quot;&quot;</span><br><span class="line">&#125;);</span><br><span class="line">function getStudInfo(studInfo:object) &#123; // 通信用的函数</span><br><span class="line">    Object.assign(stud, studInfo);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;wrapper&quot;&gt;</span><br><span class="line">        &lt;span v-show=&quot;stud.name&quot;&gt;姓名：&#123;&#123; stud.name &#125;&#125;&lt;/span&gt;</span><br><span class="line">        &lt;img v-show=&quot;stud.imageLink&quot; :src=&quot;stud.imageLink&quot; /&gt;</span><br><span class="line">        &lt;span v-show=&quot;stud.intro&quot;&gt;介绍：&#123;&#123; stud.intro &#125;&#125;&lt;/span&gt;</span><br><span class="line">        &lt;Son :getStudInfo=&quot;getStudInfo&quot;&gt;&lt;/Son&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">    .wrapper &#123;</span><br><span class="line">        background-color: #efc;</span><br><span class="line">        box-shadow: 2px 1px 10px #878787;</span><br><span class="line">        border-radius: .5rem;</span><br><span class="line">        padding: 25px;</span><br><span class="line">        box-sizing: border-box;</span><br><span class="line">    &#125;</span><br><span class="line">    img &#123;</span><br><span class="line">        height: 100px;</span><br><span class="line">        display: block;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<ol start="2" type="1">
<li>在子组件中获取 <code>getStudInfo</code> 函数，定义
<code>studInfo</code> 对象，并调用 <code>getStudInfo</code>
函数，将子组件的 <code>studInfo</code> 传递给父组件。</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;script lang=&quot;ts&quot; setup&gt;</span><br><span class="line">import &#123; reactive, defineProps &#125; from &quot;vue&quot;;</span><br><span class="line">defineProps([&quot;getStudInfo&quot;]);</span><br><span class="line">let studInfo = &#123;</span><br><span class="line">	name: &quot;李小狼&quot;,</span><br><span class="line">	imageLink:</span><br><span class="line">		&quot;https://c-ssl.duitang.com/uploads/blog/202209/14/20220914164706_1c29a.jpeg&quot;,</span><br><span class="line">	intro: &quot;李小狼，是CLAMP所著日本漫画《魔卡少女樱》及其衍生作品中的男主角，出生于中国香港。李小狼和木之本樱同年级的男生，友枝中学1年级2班/3班的学生。与魔法师库洛·里德是远亲（库洛里多的母亲出身中国李家），自身亦拥有很强的魔力。为了寻找被解除封印的库洛牌，来到日本，遇到了木之本樱。两人一起行动，逐渐相互产生了爱慕之情。擅长使用水、火、风、雷魔法，支持小樱收集库洛牌。虽然不爱说话给人一种酷酷的感觉，但其实是直爽又害羞的孩子。另外，还擅长弹钢琴、制作中式糕点。收集完卡片之后返回了香港。&quot;,</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div class=&quot;bkg&quot;&gt;</span><br><span class="line">		&lt;!-- 直接@click调用函数 --&gt;</span><br><span class="line">		&lt;button @click=&quot;getStudInfo(studInfo)&quot;&gt;发送学生信息&lt;/button&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.bkg &#123;</span><br><span class="line">	background-color: cadetblue;</span><br><span class="line">	box-shadow: 2px 1px 10px #878787;</span><br><span class="line">	border-radius: 0.5rem;</span><br><span class="line">    padding: 10px;</span><br><span class="line">    margin-top: 20px;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p>效果：</p>
<p><img src="/img/vue3-26.gif" /></p>
<p>但是显然，这种通信方式是很麻烦的，尤其是当层级关系变复杂时，子组件到父组件的通信非常困难，因此，props
一般只用于父组件到子组件的通信。</p>
<h3 id="自定义事件">12.2 自定义事件</h3>
<p>自定义事件允许我们定义自己的事件，它也可以实现子组件到父组件的传参。</p>
<h4 id="event">12.2.1 $event</h4>
<p>在聊自定义事件之前，我们先来回顾 <code>@click</code>。学过 vue2
的同学应该对 <code>@click</code>
很熟悉，它代表点击事件，当某个元素被点击时，就会触发对应的回调函数。这里来回顾一个比较容易被遗忘的点，那就是回调函数中的
<code>$event</code>
对象。这是一个隐藏参数，是一个事件对象，携带了事件信息，如果你想获取这个对象，那就必须在回调函数中写上这个参数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;script lang=&quot;ts&quot; setup&gt;</span><br><span class="line">function showEventObj($event) &#123;</span><br><span class="line">    console.log($event);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div class=&quot;wrapper&quot;&gt;</span><br><span class="line">        &lt;button @click=&quot;showEventObj&quot;&gt;打印事件对象&lt;/button&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.wrapper &#123;</span><br><span class="line">	background-color: #efc;</span><br><span class="line">	box-shadow: 2px 1px 10px #878787;</span><br><span class="line">	border-radius: 0.5rem;</span><br><span class="line">	padding: 25px;</span><br><span class="line">	box-sizing: border-box;</span><br><span class="line">&#125;</span><br><span class="line">img &#123;</span><br><span class="line">	height: 100px;</span><br><span class="line">	display: block;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p>得到结果：</p>
<p><img src="/img/vue3-21.png" /></p>
<p>有关于这个对象的内容就不具体聊了，这是 DOM
的基础知识。但是有这么几件事应该清楚：当回调函数中有多个参数时，如果需要用到
<code>$event</code>，<strong>定义时</strong>就必须把 <code>$event</code>
参数写在最右，因为 <code>$event</code>
永远是作为最后一个参数传入的，<strong>调用时</strong>可写可不写。而当回调函数是无参时，如果需要用到
<code>$event</code>，<strong>调用时</strong>要么不写参数，要么就写
<code>$event</code>。</p>
<h4 id="emit">12.2.2 emit</h4>
<p>接下来介绍自定义事件，所谓自定义事件，就是指我们自己定义一个事件，当我们说这个事件被触发了时，它才会触发。假设我们定义了一个名为
<code>send-student</code> 的事件，当该事件被触发时，会调用一个名为
<code>getStudInfo</code>
的函数，那么我们可以在一个元素上绑定该事件和回调函数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div @send-student=&quot;getStudInfo(stud)&quot;&gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<p>那么如何定义和触发这个 <code>send-student</code>
呢？自定义事件可以定义在任何组件里，当某个组件的该事件被触发时，都会导致回调函数被调用，所以自定义事件和
props
一样，都可以利用这一点来进行父子之间的通信。下面，我们在父组件，为子组件的元素绑定
<code>send-student</code> 事件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">import type &#123; log &#125; from &#x27;console&#x27;;</span><br><span class="line">&lt;script lang=&quot;ts&quot; setup&gt;</span><br><span class="line">import Son from &quot;@/components/communication/custom_event/Son.vue&quot;;</span><br><span class="line">import &#123; reactive &#125; from &quot;vue&quot;;</span><br><span class="line">let stud = reactive(&#123;</span><br><span class="line">	name: &quot;&quot;,</span><br><span class="line">	imageLink: &quot;&quot;,</span><br><span class="line">	intro: &quot;&quot;,</span><br><span class="line">&#125;);</span><br><span class="line">function getStudInfo(studInfo: object) &#123;</span><br><span class="line">	Object.assign(stud, studInfo);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div class=&quot;wrapper&quot;&gt;</span><br><span class="line">		&lt;span v-show=&quot;stud.name&quot;&gt;姓名：&#123;&#123; stud.name &#125;&#125;&lt;/span&gt;</span><br><span class="line">		&lt;img v-show=&quot;stud.imageLink&quot; :src=&quot;stud.imageLink&quot; /&gt;</span><br><span class="line">		&lt;span v-show=&quot;stud.intro&quot;&gt;介绍：&#123;&#123; stud.intro &#125;&#125;&lt;/span&gt;</span><br><span class="line">		&lt;!-- 绑定事件 --&gt;</span><br><span class="line">		&lt;Son @send-student=&quot;getStudInfo&quot;&gt;&lt;/Son&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.wrapper &#123;</span><br><span class="line">	background-color: #efc;</span><br><span class="line">	box-shadow: 2px 1px 10px #878787;</span><br><span class="line">	border-radius: 0.5rem;</span><br><span class="line">	padding: 25px;</span><br><span class="line">	box-sizing: border-box;</span><br><span class="line">&#125;</span><br><span class="line">img &#123;</span><br><span class="line">	height: 100px;</span><br><span class="line">	display: block;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p>接下来在子组件中定义和触发 <code>send-student</code>
事件。定义自定义事件需要用到 <code>defineEmits</code>
这个函数，该函数是一个宏，所以使用前不需要进行引入。函数接收一个事件数组，数组中的内容就是事件的名字。该函数返回一个
<code>emit</code> 函数，通过 <code>emit</code>
可以触发自定义事件。<code>emit</code>
接收两种参数，第一个参数是自定义事件的名字，表示声明被触发的是哪一个自定义事件，第二类参数就是事件的回调函数的参数，这些参数会被传入回调函数中。下面是子组件中定义和触发自定义事件的方法，自定义事件
<code>send-student</code> 将在按钮被点击后触发：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;script lang=&quot;ts&quot; setup&gt;</span><br><span class="line">let studInfo = &#123;</span><br><span class="line">	name: &quot;李小狼&quot;,</span><br><span class="line">	imageLink:</span><br><span class="line">		&quot;https://c-ssl.duitang.com/uploads/blog/202209/14/20220914164706_1c29a.jpeg&quot;,</span><br><span class="line">	intro: &quot;李小狼，是CLAMP所著日本漫画《魔卡少女樱》及其衍生作品中的男主角，出生于中国香港。李小狼和木之本樱同年级的男生，友枝中学1年级2班/3班的学生。与魔法师库洛·里德是远亲（库洛里多的母亲出身中国李家），自身亦拥有很强的魔力。为了寻找被解除封印的库洛牌，来到日本，遇到了木之本樱。两人一起行动，逐渐相互产生了爱慕之情。擅长使用水、火、风、雷魔法，支持小樱收集库洛牌。虽然不爱说话给人一种酷酷的感觉，但其实是直爽又害羞的孩子。另外，还擅长弹钢琴、制作中式糕点。收集完卡片之后返回了香港。&quot;,</span><br><span class="line">&#125;;</span><br><span class="line">const emit = defineEmits([&quot;send-student&quot;]);  // 定义自定义事件</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div class=&quot;bkg&quot;&gt;</span><br><span class="line">		&lt;span v-show=&quot;studInfo.name&quot;&gt;姓名：&#123;&#123; studInfo.name &#125;&#125;&lt;/span&gt;</span><br><span class="line">		&lt;img v-show=&quot;studInfo.imageLink&quot; :src=&quot;studInfo.imageLink&quot; /&gt;</span><br><span class="line">		&lt;span v-show=&quot;studInfo.intro&quot;&gt;介绍：&#123;&#123; studInfo.intro &#125;&#125;&lt;/span&gt;</span><br><span class="line">		&lt;br&gt;&lt;br&gt;</span><br><span class="line">		&lt;!-- 触发自定义事件 --&gt;</span><br><span class="line">		&lt;button @click=&quot;emit(&#x27;send-student&#x27;, studInfo)&quot;&gt;发送学生信息&lt;/button&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.bkg &#123;</span><br><span class="line">	background-color: cadetblue;</span><br><span class="line">	box-shadow: 2px 1px 10px #878787;</span><br><span class="line">	border-radius: 0.5rem;</span><br><span class="line">	padding: 10px;</span><br><span class="line">	margin-top: 20px;</span><br><span class="line">&#125;</span><br><span class="line">img &#123;</span><br><span class="line">	height: 100px;</span><br><span class="line">	display: block;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p>效果：</p>
<p><img src="/img/vue3-27.gif" /></p>
<p>如此一来，通过自定义事件也完成了子组件到父组件的通信。一个注意事项：自定义事件的命名一般采用
kebab-case
的命名方式，即单词之间采用短横线来分隔，就像上面写的一样，这是官方推荐的写法。</p>
<h3 id="mitt">12.3 mitt</h3>
<p>之前介绍的 props
和自定义事件都可以实现组件间通信，但缺点是在处理子组件到父组件的通信时比较复杂，<code>mitt</code>
可以实现任意组件之间的通信。</p>

            </div>
        
        <footer class="article-footer">
        </footer>
    </div>
</article>


    
<nav id="article-nav">
    
        <a href="/2024/04/03/%E5%9B%BE%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6/" id="article-nav-newer" class="article-nav-link-wrap">
            <strong class="article-nav-caption">Newer</strong>
            <div class="article-nav-title">
                
                    图注意力机制的原理
                
            </div>
        </a>
    
    
        <a href="/2023/12/11/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD%E6%8A%80%E6%9C%AF/" id="article-nav-older" class="article-nav-link-wrap">
            <strong class="article-nav-caption">Older</strong>
            <div class="article-nav-title">人工智能技术杂谈</div>
        </a>
    
</nav>





    
    




<!-- baidu url auto push script -->
<script type="text/javascript">
    !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=window.location.href,o=document.referrer;if(!e.test(r)){var n="//api.share.baidu.com/s.gif";o?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var t=new Image;t.src=n}}(window);
</script>     
</section>
        </div>
        

    
        
<script src="/libs/lightgallery/js/lightgallery.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-pager.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-zoom.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-hash.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-share.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-video.min.js"></script>

    
    
        
<script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>

    
    
        <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true,
            TeX: {
                equationNumbers: {
                  autoNumber: 'AMS'
                }
            }
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    



<!-- Custom Scripts -->

<script src="/js/main.js"></script>


    </div>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>